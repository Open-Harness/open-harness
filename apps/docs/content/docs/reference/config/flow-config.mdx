---
title: Flow Configuration
description: Configuration options for flow execution
---

# Flow Configuration

Configuration options for YAML flow definitions and execution context.

## Flow Metadata

```yaml
flow:
  name: string           # Required: flow identifier
  version: number        # Optional: schema version (default: 1)
  description: string    # Optional: human-readable description
  input: object          # Optional: default input values
  policy: FlowPolicy     # Optional: execution policy
```

### name

**Type**: `string`
**Required**: Yes

Unique identifier for the flow.

```yaml
flow:
  name: content-pipeline
```

### version

**Type**: `number`
**Required**: No
**Default**: `1`

Schema version for future compatibility.

```yaml
flow:
  name: my-flow
  version: 2
```

### description

**Type**: `string`
**Required**: No

Human-readable description.

```yaml
flow:
  name: data-sync
  description: Synchronize data between source and target systems
```

### input

**Type**: `Record<string, unknown>`
**Required**: No

Default input values. Can be overridden at execution time.

```yaml
flow:
  name: api-client
  input:
    baseUrl: "https://api.example.com"
    timeout: 30000
    retries: 3
```

### policy

```yaml
flow:
  name: robust-pipeline
  policy:
    failFast: false  # Continue on errors
```

| Property | Type | Default | Description |
|----------|------|---------|-------------|
| `failFast` | `boolean` | `true` | Stop on first error |

## Node Policy

```yaml
nodes:
  - id: step1
    type: http
    input: {}
    policy:
      timeoutMs: number
      retry: RetryPolicy
      continueOnError: boolean
```

### timeoutMs

**Type**: `number` (milliseconds)
**Required**: No

Maximum execution time for the node.

```yaml
policy:
  timeoutMs: 30000  # 30 seconds
```

### retry

```yaml
policy:
  retry:
    maxAttempts: 3    # Required: total attempts
    backoffMs: 1000   # Optional: delay between retries (default: 0)
```

| Property | Type | Default | Description |
|----------|------|---------|-------------|
| `maxAttempts` | `number` | `1` | Total execution attempts |
| `backoffMs` | `number` | `0` | Delay between retries |

### continueOnError

**Type**: `boolean`
**Required**: No
**Default**: `false`

Whether flow should continue if this node fails.

```yaml
policy:
  continueOnError: true  # Don't stop flow on error
```

## FlowExecutionContext

When calling `executeFlow()`:

```typescript
interface FlowExecutionContext {
  hub: Hub;
  phase: <T>(name: string, fn: () => Promise<T>) => Promise<T>;
  task: <T>(id: string, fn: () => Promise<T>) => Promise<T>;
}
```

### Example

```typescript
import { executeFlow, parseFlowYaml, createHub } from "@open-harness/kernel";

const hub = createHub();

const ctx: FlowExecutionContext = {
  hub,
  phase: async (name, fn) => {
    hub.emit({ type: "phase:start", name });
    try {
      const result = await fn();
      hub.emit({ type: "phase:complete", name });
      return result;
    } catch (error) {
      hub.emit({ type: "phase:failed", name, error: error.message });
      throw error;
    }
  },
  task: async (id, fn) => {
    hub.emit({ type: "task:start", taskId: id });
    try {
      const result = await fn();
      hub.emit({ type: "task:complete", taskId: id, result });
      return result;
    } catch (error) {
      hub.emit({ type: "task:failed", taskId: id, error: error.message });
      throw error;
    }
  },
};

const flow = parseFlowYaml(yamlString);
const result = await executeFlow(flow, registry, ctx);
```

## Input Overrides

Override flow input at execution time:

```typescript
const result = await executeFlow(flow, registry, ctx, {
  baseUrl: "https://staging.example.com",
  timeout: 60000,
});
```

Overrides merge with flow-defined defaults.

## Complete Example

```yaml
flow:
  name: resilient-pipeline
  version: 1
  description: A fault-tolerant data processing pipeline
  input:
    source: "https://api.example.com"
    batchSize: 100
    maxErrors: 5
  policy:
    failFast: false

nodes:
  - id: fetch
    type: http
    input:
      url: "{{flow.input.source}}/data"
    policy:
      timeoutMs: 60000
      retry:
        maxAttempts: 3
        backoffMs: 2000

  - id: validate
    type: schema-validator
    input:
      data: "{{fetch.output}}"
    policy:
      continueOnError: true

  - id: transform
    type: map
    input:
      items: "{{fetch.output.items}}"
      batchSize: "{{flow.input.batchSize}}"

  - id: save
    type: database
    input:
      records: "{{transform.output}}"
    policy:
      timeoutMs: 120000
      retry:
        maxAttempts: 5
        backoffMs: 5000

edges:
  - from: fetch
    to: validate
  - from: validate
    to: transform
  - from: transform
    to: save
```

## See Also

- [executeFlow](/reference/api/execute-flow) - Execution API
- [FlowYaml](/reference/types/flow-yaml) - Flow type
- [NodeSpec](/reference/types/node-spec) - Node specification
