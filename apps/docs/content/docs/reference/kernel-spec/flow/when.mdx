---
title: "WhenExpr Protocol"
description: "`WhenExpr` is a boolean expression that gates node or edge execution."
---

`WhenExpr` is a boolean expression that gates node or edge execution.

## Grammar

```yaml
# equals
when:
  equals:
    var: string      # VarPath
    value: any

# not
when:
  not: &#60;WhenExpr&#62;

# and
when:
  and:
    - &#60;WhenExpr&#62;
    - &#60;WhenExpr&#62;

# or
when:
  or:
    - &#60;WhenExpr&#62;
    - &#60;WhenExpr&#62;
```

## VarPath

Var paths use dot notation and are resolved against the **binding context** (same as bindings):

- `flow.input.&#60;key...&#62;`
- `&#60;nodeId&#62;.&#60;key...&#62;` (node outputs)

### Example

```yaml
when:
  equals:
    var: "isFrench.value"
    value: true
```

This resolves `isFrench.value` from the `isFrench` node's output.

## Evaluation semantics

- If `when` evaluates to `true`, the node or edge executes
- If `when` evaluates to `false`, the node or edge is **skipped**
- If `when` is omitted, the node or edge always executes

### Skip behavior

When a node is skipped:
- The engine records a skipped marker in outputs (shape is engine-defined)
- Downstream nodes can still run if they don't depend on that output
- The skipped node's output is not available for bindings (it's the skip marker)

## Examples

### Simple condition

```yaml
nodes:
  - id: isFrench
    type: condition.equals
    input:
      left: "&#123;&#123;facts.officialLanguage&#125;&#125;"
      right: "French"
    # Output: &#123; value: true &#125;

  - id: sayFrench
    type: claude.agent
    when:
      equals:
        var: "isFrench.value"
        value: true
    input:
      prompt: "Write in French..."
```

### Negation

```yaml
when:
  not:
    equals:
      var: "isFrench.value"
      value: true
```

### Complex logic

```yaml
when:
  and:
    - equals:
        var: "isFrench.value"
        value: true
    - equals:
        var: "flow.input.country"
        value: "Benin"
```

```yaml
when:
  or:
    - equals:
        var: "isFrench.value"
        value: true
    - equals:
        var: "isSpanish.value"
        value: true
```

## Error handling

If a `var` path cannot be resolved:
- The expression evaluates to `false` (node or edge is skipped)
- This prevents errors from propagating (safer than failing the flow)

## Key invariants

1. **WhenExpr is evaluated before node/edge execution** - it gates whether the node or edge runs
2. **Skip is not failure** - skipped nodes don't fail the flow
3. **VarPath uses the same resolution as bindings** - `flow.input.*` and `&#60;nodeId&#62;.*`
