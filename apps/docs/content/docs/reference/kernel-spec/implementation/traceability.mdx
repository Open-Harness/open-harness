---
title: "Traceability Matrix"
description: "This matrix maps **spec â†’ test-spec â†’ tests â†’ live scripts** to prevent gaps and ensure complete coverage."
---

This matrix maps **spec â†’ test-spec â†’ tests â†’ live scripts** to prevent gaps and ensure complete coverage.

## Status Legend

- âœ… **Implemented**: Code exists, tests pass, live script works
- ğŸŸ¡ **Interface-only**: Protocol types defined, no runtime implementation yet
- â³ **Planned**: In roadmap, not yet started
- âŒ **Missing**: Should exist but doesn't

## Kernel Protocol

### Events

| Spec Module | Test Spec | Requirements | Unit Tests | Replay Tests | Live Script | Status |
|------------|-----------|--------------|------------|--------------|-------------|--------|
| `docs/spec/events.md` | `tests/specs/events.test-spec.md` | R1-R4 | `tests/unit/events.*.test.ts` | `tests/replay/events.*.test.ts` | `scripts/live/events-live.ts` | ğŸŸ¡ |

**Requirements**:
- R1: Event Envelope Structure
- R2: Context Structure
- R3: Event Type Definitions
- R4: Event Filtering Types

**Note**: Events is primarily type definitions. Tests validate type contracts.

---

### Hub

| Spec Module | Test Spec | Requirements | Unit Tests | Replay Tests | Live Script | Status |
|------------|-----------|--------------|------------|--------------|-------------|--------|
| `docs/spec/hub.md` | `tests/specs/hub.test-spec.md` | R1-R7 | `tests/unit/hub.filter.test.ts` | `tests/replay/hub.*.test.ts` | `scripts/live/hub-live.ts` | ğŸŸ¡ |

**Requirements**:
- R1: Event Subscription (Basic)
- R2: Event Filtering
- R3: Context Scoping (AsyncLocalStorage)
- R4: Unsubscribe
- R5: Async Iteration
- R6: Commands (Bidirectional)
- R7: Status Tracking

**Note**: Hub is interface contract. Tests validate interface semantics.

---

### FlowRuntime

| Spec Module | Test Spec | Requirements | Unit Tests | Replay Tests | Live Script | Status |
|------------|-----------|--------------|------------|--------------|-------------|--------|
| `docs/spec/flow-runtime.md` | `tests/specs/flow-runtime.test-spec.md` | R1-R3 | `tests/unit/flow.runtime.*.test.ts` | `tests/replay/flow.runtime.test.ts` | `scripts/live/flow-runtime-live.ts` | ğŸŸ¡ |

**Requirements**:
- R1: Run Lifecycle Events
- R2: Task Events Per Node
- R3: Inbox Routing

**Note**: FlowRuntime is the canonical runtime. Tests validate lifecycle, context, and inbox routing.

---

### Agent

| Spec Module | Test Spec | Requirements | Unit Tests | Replay Tests | Live Script | Status |
|------------|-----------|--------------|------------|--------------|-------------|--------|
| `docs/spec/agent.md` | `tests/specs/agent.test-spec.md` | R1-R6 | `tests/unit/agent.*.test.ts` | `tests/replay/agent.*.test.ts` | `scripts/live/agent-live.ts` | ğŸŸ¡ |

**Requirements**:
- R1: AgentDefinition Contract
- R2: AgentExecuteContext
- R3: Inbox Interface
- R4: emitsStartComplete Flag
- R5: ExecutableAgent Wrapper
- R6: RunId Uniqueness

**Note**: Agent is interface contract. Tests validate contract semantics.

---

### Channel

| Spec Module | Test Spec | Requirements | Unit Tests | Replay Tests | Live Script | Status |
|------------|-----------|--------------|------------|--------------|-------------|--------|
| `docs/spec/channel.md` | `tests/specs/channel.test-spec.md` | R1-R6 | `tests/unit/channel.*.test.ts` | `tests/replay/channel.*.test.ts` | `scripts/live/channel-live.ts` | ğŸŸ¡ |

**Requirements**:
- R1: ChannelDefinition Structure
- R2: Attachment Contract
- R3: Event Subscription Pattern
- R4: State Management
- R5: Command Sending
- R6: Lifecycle Hooks

**Note**: Channel is interface contract. Tests validate attachment patterns.

---

## Flow Protocol

### FlowSpec

| Spec Module | Test Spec | Requirements | Unit Tests | Replay Tests | Live Script | Status |
|------------|-----------|--------------|------------|--------------|-------------|--------|
| `docs/flow/flow-spec.md` | `tests/specs/flow.test-spec.md` | R1 | `tests/unit/flow.flowspec.test.ts` | `tests/replay/flow.flowspec.test.ts` | `scripts/live/flow-live.ts` | ğŸŸ¡ |

**Requirements**:
- R1: FlowSpec Structure

---

### NodeSpec

| Spec Module | Test Spec | Requirements | Unit Tests | Replay Tests | Live Script | Status |
|------------|-----------|--------------|------------|--------------|-------------|--------|
| `docs/flow/flow-spec.md` | `tests/specs/flow.test-spec.md` | R2 | `tests/unit/flow.nodespec.test.ts` | `tests/replay/flow.nodespec.test.ts` | `scripts/live/flow-live.ts` | ğŸŸ¡ |

**Requirements**:
- R2: NodeSpec Structure

---

### WhenExpr

| Spec Module | Test Spec | Requirements | Unit Tests | Replay Tests | Live Script | Status |
|------------|-----------|--------------|------------|--------------|-------------|--------|
| `docs/flow/when.md` | `tests/specs/flow.test-spec.md` | R3 | `tests/unit/flow.when.test.ts` | `tests/replay/flow.when.test.ts` | `scripts/live/flow-live.ts` | ğŸŸ¡ |

**Requirements**:
- R3: WhenExpr Grammar

---

### Bindings

| Spec Module | Test Spec | Requirements | Unit Tests | Replay Tests | Live Script | Status |
|------------|-----------|--------------|------------|--------------|-------------|--------|
| `docs/flow/bindings.md` | `tests/specs/flow.test-spec.md` | R4 | `tests/unit/flow.bindings.test.ts` | `tests/replay/flow.bindings.test.ts` | `scripts/live/flow-live.ts` | ğŸŸ¡ |

**Requirements**:
- R4: Binding Paths

---

### Edges

| Spec Module | Test Spec | Requirements | Unit Tests | Replay Tests | Live Script | Status |
|------------|-----------|--------------|------------|--------------|-------------|--------|
| `docs/flow/flow-spec.md` | `tests/specs/flow.test-spec.md` | R5 | `tests/unit/flow.edges.test.ts` | `tests/replay/flow.edges.test.ts` | `scripts/live/flow-live.ts` | ğŸŸ¡ |

**Requirements**:
- R5: Edge Requirements

---

### NodePolicy

| Spec Module | Test Spec | Requirements | Unit Tests | Replay Tests | Live Script | Status |
|------------|-----------|--------------|------------|--------------|-------------|--------|
| `docs/flow/flow-spec.md` | `tests/specs/flow.test-spec.md` | R6 | `tests/unit/flow.policy.test.ts` | `tests/replay/flow.policy.test.ts` | `scripts/live/flow-live.ts` | ğŸŸ¡ |

**Requirements**:
- R6: NodePolicy Structure

---

### FlowYaml

| Spec Module | Test Spec | Requirements | Unit Tests | Replay Tests | Live Script | Status |
|------------|-----------|--------------|------------|--------------|-------------|--------|
| `docs/flow/flow-spec.md` | `tests/specs/flow.test-spec.md` | R7 | `tests/unit/flow.flowyaml.test.ts` | `tests/replay/flow.flowyaml.test.ts` | `scripts/live/flow-live.ts` | ğŸŸ¡ |

**Requirements**:
- R7: FlowYaml Structure

---

### Execution

| Spec Module | Test Spec | Requirements | Unit Tests | Replay Tests | Live Script | Status |
|------------|-----------|--------------|------------|--------------|-------------|--------|
| `docs/flow/execution.md` | (covered by flow.test-spec.md) | N/A | `tests/unit/flow.executor.test.ts` | `tests/replay/flow.executor.test.ts` | `scripts/live/flow-live.ts` | ğŸŸ¡ |

**Note**: Execution semantics are tested via end-to-end flow tests.

---

### Registry

| Spec Module | Test Spec | Requirements | Unit Tests | Replay Tests | Live Script | Status |
|------------|-----------|--------------|------------|--------------|-------------|--------|
| `docs/flow/registry.md` | (covered by flow.test-spec.md) | N/A | `tests/unit/flow.registry.test.ts` | `tests/replay/flow.registry.test.ts` | `scripts/live/flow-live.ts` | ğŸŸ¡ |

**Note**: Registry is tested via node type registration and lookup.

---

## Testing Protocol

### Testing Infrastructure

| Spec Module | Test Spec | Requirements | Unit Tests | Replay Tests | Live Script | Status |
|------------|-----------|--------------|------------|--------------|-------------|--------|
| `docs/testing/testing-protocol.md` | N/A | N/A | N/A | N/A | N/A | âœ… |

**Note**: Testing protocol is documentation-only (no runtime to test).

---

## Coverage Summary

| Category | Spec Modules | Test Specs | Requirements | Status |
|----------|--------------|------------|--------------|--------|
| Kernel Protocol | 5 | 5 | 29 | ğŸŸ¡ Interface-only |
| Flow Protocol | 6 | 1 | 7 | ğŸŸ¡ Interface-only |
| Testing Protocol | 1 | 0 | 0 | âœ… Docs only |
| **Total** | **12** | **6** | **36** | **ğŸŸ¡ Mostly interface-only** |

---

## Update Process

When implementing a milestone:

1. **Update status** from ğŸŸ¡ to â³ when starting
2. **Update status** from â³ to âœ… when milestone complete
3. **Add test file paths** when tests are written
4. **Add fixture paths** when fixtures are recorded
5. **Add live script path** when live script is written

---

## Gap Detection

This matrix helps detect gaps:

- **Missing test spec**: Spec module exists but no test-spec file
- **Missing requirements**: Test spec exists but no requirements defined
- **Missing tests**: Requirements exist but no test files
- **Missing fixtures**: Replay tests exist but no fixtures
- **Missing live script**: Tests exist but no authoritative script

**Rule**: Every spec module should have a test spec. Every requirement should have a test. Every replay test should have a fixture. Every milestone should have a live script.
