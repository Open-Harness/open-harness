---
title: evaluateWhen
description: Evaluate conditional WhenExpr expressions against binding context
---

# evaluateWhen

Evaluates a WhenExpr conditional expression against a binding context. Used for conditional node execution in flows.

## Signature

```typescript
function evaluateWhen(
  expr: WhenExpr | undefined,
  context: BindingContext
): boolean
```

## Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `expr` | `WhenExpr \| undefined` | No | Conditional expression to evaluate |
| `context` | `BindingContext` | Yes | Context with values to evaluate against |

## Returns

`boolean` - `true` if condition passes (or expr is undefined), `false` otherwise.

## Example

```typescript
import { evaluateWhen } from "@open-harness/kernel";

const context = {
  flow: { input: { mode: "production", count: 5 } },
  step1: { output: { status: "success" } },
};

// Simple equals check
const shouldRun = evaluateWhen(
  { equals: { var: "flow.input.mode", value: "production" } },
  context
);
console.log(shouldRun); // true

// No condition always returns true
const noCondition = evaluateWhen(undefined, context);
console.log(noCondition); // true
```

## WhenExpr Operators

### equals

Check if a binding value equals a literal:

```typescript
const expr = {
  equals: {
    var: "flow.input.env",
    value: "production"
  }
};

// Matches any JSON-serializable value
const numericExpr = {
  equals: {
    var: "step1.count",
    value: 42
  }
};

const objectExpr = {
  equals: {
    var: "step1.config",
    value: { enabled: true }
  }
};
```

### not

Negate a condition:

```typescript
const expr = {
  not: {
    equals: { var: "flow.input.disabled", value: true }
  }
};
```

### and

All conditions must be true:

```typescript
const expr = {
  and: [
    { equals: { var: "flow.input.mode", value: "production" } },
    { equals: { var: "step1.status", value: "success" } },
  ]
};
```

### or

Any condition must be true:

```typescript
const expr = {
  or: [
    { equals: { var: "flow.input.mode", value: "development" } },
    { equals: { var: "flow.input.mode", value: "staging" } },
  ]
};
```

## Complex Expressions

Operators can be nested for complex logic:

```typescript
const expr = {
  and: [
    {
      or: [
        { equals: { var: "flow.input.env", value: "staging" } },
        { equals: { var: "flow.input.env", value: "production" } },
      ]
    },
    {
      not: {
        equals: { var: "flow.input.skipValidation", value: true }
      }
    }
  ]
};
```

## Flow YAML Usage

```yaml
flow:
  name: conditional-flow
  input:
    mode: "production"
    debug: false

nodes:
  - id: production_step
    type: deploy
    input: {}
    when:
      equals:
        var: flow.input.mode
        value: "production"

  - id: debug_step
    type: log
    input: {}
    when:
      and:
        - equals:
            var: flow.input.debug
            value: true
        - not:
            equals:
              var: flow.input.mode
              value: "production"

edges:
  - from: production_step
    to: debug_step
```

## Missing Values

If the binding path doesn't exist, `equals` returns `false`:

```typescript
const expr = { equals: { var: "missing.path", value: "anything" } };
const result = evaluateWhen(expr, { flow: { input: {} } });
console.log(result); // false
```

## Deep Equality

The `equals` operator performs deep equality comparison:

```typescript
const context = {
  flow: { input: {} },
  step1: { output: { items: [1, 2, 3] } }
};

const expr = {
  equals: {
    var: "step1.output.items",
    value: [1, 2, 3]
  }
};

const result = evaluateWhen(expr, context);
console.log(result); // true
```

## See Also

- [When Syntax](/docs/reference/when/when-syntax) - Complete syntax reference
- [Operators](/docs/reference/when/operators) - Operator details
- [When Spec](/docs/reference/kernel-spec/flow/when) - Specification
