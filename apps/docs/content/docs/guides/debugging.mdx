---
title: Debugging
description: Debug flows and diagnose issues
---

# Debugging

This guide covers techniques for debugging Open Harness flows, from simple logging to advanced troubleshooting.

## Quick Start

### Enable Debug Logging

```bash
LOG_LEVEL=debug bun run flow-run --file flow.yaml
```

### Watch All Events

```typescript
hub.subscribe("*", (event) => {
  console.log(`[${event.event.type}]`, JSON.stringify(event.event, null, 2));
});
```

---

## Troubleshooting Decision Tree

Use this tree to diagnose issues:

```
Flow not running?
├─ Check: Is the flow YAML valid?
│   └─ Run: `bun run flow-run --validate flow.yaml`
├─ Check: Are all node types registered?
│   └─ Look for: "Unknown node type" errors
└─ Check: Is the hub properly connected?
    └─ Look for: "Hub not initialized" errors

Node not executing?
├─ Check: Are dependencies satisfied?
│   └─ Look for: "Unresolved incoming edges" errors
├─ Check: Is the `when` condition passing?
│   └─ Add: `console.log` in when evaluator
└─ Check: Is the node in the execution order?
    └─ Look for: Node in `compiled.order`

Node failing?
├─ Check: Is input valid?
│   └─ Look for: Zod validation errors
├─ Check: Is the node implementation correct?
│   └─ Add: Try/catch with detailed logging
└─ Check: Is there a timeout?
    └─ Look for: "Node execution timeout" errors

Binding not resolving?
├─ Check: Does the source node exist?
│   └─ Verify: Node ID in `{{nodeId.field}}`
├─ Check: Does the source output have the field?
│   └─ Log: Source node's output
└─ Check: Is the syntax correct?
    └─ Use: `{{nodeId.field}}` not `${nodeId.field}`
```

---

## Event Inspection

### Key Events to Watch

| Event | When It Fires | What to Look For |
|-------|---------------|------------------|
| `node:start` | Before node runs | Correct node ID, input values |
| `node:complete` | After success | Output values |
| `node:error` | On failure | Error message, stack trace |
| `node:skipped` | When skipped | Reason (edge or when) |
| `agent:text` | Agent output | Response content |
| `agent:thinking` | Agent thinking | Reasoning (if enabled) |

### Filtering Events

```typescript
// Only node lifecycle events
hub.subscribe("node:*", (event) => {
  console.log(event.event);
});

// Only agent events
hub.subscribe("agent:*", (event) => {
  console.log(event.event);
});

// Specific node
hub.subscribe("*", (event) => {
  if (event.context.task?.id === "my-node") {
    console.log(event.event);
  }
});
```

### Pretty Printing Events

```typescript
import { formatEvent } from "./debug-utils";

hub.subscribe("*", (event) => {
  console.log(formatEvent(event));
});

// Example formatter
function formatEvent(e: EnrichedEvent): string {
  const time = e.timestamp.toISOString().slice(11, 23);
  const type = e.event.type.padEnd(20);
  const ctx = e.context.task?.id ?? "flow";
  return `[${time}] ${type} | ${ctx}`;
}
```

---

## Common Issues & Solutions

### 1. "Unknown node type"

**Symptom**: Flow fails with "Unknown node type: xyz"

**Cause**: Node type not registered in the registry

**Solution**:
```typescript
const registry = new NodeRegistry();

// Register the missing node type
registry.register({
  type: "xyz",
  inputSchema: z.object({ ... }),
  outputSchema: z.object({ ... }),
  run: async (ctx, input) => { ... },
});
```

### 2. "Binding resolution failed"

**Symptom**: `{{nodeId.field}}` returns undefined

**Causes**:
1. Source node hasn't run yet (edge missing)
2. Source node output doesn't have that field
3. Typo in node ID or field name

**Debug Steps**:
```typescript
// Log the binding context before resolution
console.log("Binding context:", JSON.stringify(bindingContext, null, 2));

// Check if source node output exists
console.log("Source output:", outputs["sourceNodeId"]);
```

**Solution**:
```yaml
# Ensure edge exists
edges:
  - from: sourceNode
    to: targetNode

# Verify field name matches output schema
nodes:
  - id: sourceNode
    type: myType
    # Output: { response: "..." }

  - id: targetNode
    type: otherType
    input:
      data: "{{sourceNode.response}}"  # Correct field name
```

### 3. "Node skipped unexpectedly"

**Symptom**: Node shows `skipped: true` in output

**Causes**:
1. `when` condition evaluated to false
2. No incoming edges fired

**Debug Steps**:
```typescript
// Check why node was skipped
hub.subscribe("node:skipped", (event) => {
  console.log(`Node ${event.event.nodeId} skipped:`, event.event.reason);
});
```

**Solution for `when` issues**:
```yaml
# Before: when using wrong field
when: "{{classifier.result}} == 'urgent'"

# After: correct field path
when: "{{classifier.category}} == 'urgent'"
```

### 4. "Agent timeout"

**Symptom**: Agent node fails after waiting period

**Cause**: LLM taking too long to respond

**Solution**:
```typescript
// Increase timeout for specific node
registry.register({
  type: "agent",
  policy: {
    timeout: 60000, // 60 seconds
  },
  run: async (ctx, input) => { ... },
});

// Or use flow-level policy
flow:
  policy:
    timeout: 120000  # 2 minutes for entire flow
```

### 5. "Validation error" on input

**Symptom**: Zod validation fails for node input

**Debug Steps**:
```typescript
// Log the resolved input before validation
registry.register({
  type: "myNode",
  run: async (ctx, input) => {
    console.log("Resolved input:", JSON.stringify(input, null, 2));
    // ... rest of implementation
  },
});
```

**Common Fixes**:
```yaml
# Wrong: string instead of number
input:
  count: "5"

# Right: proper type
input:
  count: 5

# Wrong: missing required field
input:
  name: "test"

# Right: include all required fields
input:
  name: "test"
  required_field: "value"
```

---

## Advanced Debugging

### Inspecting Compiled Flow

```typescript
import { compileFlow } from "@open-harness/kernel";

const compiled = compileFlow(flow);
console.log("Execution order:", compiled.order.map(n => n.id));
console.log("Edge index:", compiled.edges);
```

### Tracing Binding Resolution

```typescript
import { resolveBindings } from "@open-harness/kernel";

const context = { flow: { input: { name: "test" } }, nodeA: { output: "hello" } };
const template = "{{nodeA.output}} {{flow.input.name}}";

const result = resolveBindings(template, context);
console.log("Resolved:", result); // "hello test"
```

### Testing When Conditions

```typescript
import { evaluateWhen } from "@open-harness/kernel";

const context = { classifier: { category: "urgent" } };
const when = "{{classifier.category}} == 'urgent'";

const result = evaluateWhen(when, context);
console.log("Should run:", result); // true
```

### Using the Visual Debugger

The Flow-UI includes built-in debugging:

1. Open the visual editor
2. Run the flow
3. Watch node states change (idle → running → success/error)
4. Click on nodes to see input/output
5. Check the EventLog panel for detailed events

---

## Debugging Checklist

Before asking for help, verify:

- [ ] YAML is valid (no syntax errors)
- [ ] All node types are registered
- [ ] Edges connect the right nodes
- [ ] Bindings use correct syntax `{{node.field}}`
- [ ] `when` conditions reference existing fields
- [ ] Input schemas match provided values
- [ ] Timeouts are sufficient for LLM calls
- [ ] Hub is properly initialized

---

## Getting Help

If you're stuck:

1. **Check the logs**: Run with `LOG_LEVEL=debug`
2. **Inspect events**: Subscribe to `*` and log everything
3. **Simplify**: Remove nodes until it works, add back one at a time
4. **Validate in isolation**: Test nodes outside the flow

## See Also

- [Event Model](/docs/concepts/event-model) — Event types and context
- [Flow Execution](/docs/reference/kernel-spec/flow/execution) — Execution semantics
- [When Syntax](/docs/reference/when/when-syntax) — Conditional expressions
- [Bindings Reference](/docs/reference/bindings/a3-syntax) — Binding syntax
