---
title: Iteration Patterns
description: Process arrays and collections with JSONata
---

# Iteration Patterns

Use JSONata to transform and iterate over collections.

## Array Mapping

Transform each item in an array:

```yaml
nodes:
  - id: process
    type: map
    input:
      items: "{{ flow.input.users }}"
      transform: |
        {{
          {
            "id": $.id,
            "displayName": $.firstName & ' ' & $.lastName,
            "active": $.status = 'active'
          }
        }}
```

## Filtering

Select items matching criteria:

```yaml
# Filter active users
users: "{{ flow.input.users[status = 'active'] }}"

# Filter by multiple conditions
items: "{{ nodes.list.output[priority > 5 and assigned] }}"

# First matching item
first: "{{ flow.input.items[type = 'primary'][0] }}"
```

## Aggregation

Reduce arrays to single values:

```yaml
# Sum values
total: "{{ $sum(nodes.orders.output.items.price) }}"

# Count items
count: "{{ $count(flow.input.users) }}"

# Average
average: "{{ $average(nodes.scores.output.values) }}"
```

## Array Construction

Build arrays from expressions:

```yaml
# Collect specific fields
names: "{{ flow.input.users.name }}"

# Unique values
categories: "{{ $distinct(nodes.items.output.category) }}"

# Sorted array
sorted: "{{ $sort(flow.input.items, function($a, $b) { $a.priority > $b.priority }) }}"
```

## Nested Iteration

Process nested structures:

```yaml
# Flatten nested arrays
allTasks: "{{ flow.input.projects.tasks }}"

# Deep field access
emails: "{{ flow.input.teams.members.contact.email }}"
```

## Next Steps

- [Migration Guide](/docs/guides/expressions/migration) — Migrate from template strings
- [JSONata Syntax](/docs/reference/expressions/syntax) — Complete syntax reference
