---
title: How to Define an Agent
description: Create an AgentDefinition for your flows
---

# How to Define an Agent

Create agent definitions that execute AI workflows within flows.

## Basic Agent Definition

```typescript
import type { AgentDefinition } from "@open-harness/kernel";

const myAgent: AgentDefinition = {
  name: "my-agent",

  async execute(input, ctx) {
    // Process input
    ctx.hub.emit({ type: "narrative", text: "Starting..." });

    // Do work
    const result = await processInput(input);

    // Emit output
    ctx.hub.emit({ type: "agent:text", content: result });

    return { result };
  }
};
```

## Agent Input/Output Types

```typescript
import { z } from "zod";
import type { AgentDefinition } from "@open-harness/kernel";

const InputSchema = z.object({
  prompt: z.string(),
  maxTokens: z.number().optional()
});

const OutputSchema = z.object({
  response: z.string(),
  tokenCount: z.number()
});

type Input = z.infer<typeof InputSchema>;
type Output = z.infer<typeof OutputSchema>;

const typedAgent: AgentDefinition<Input, Output> = {
  name: "typed-agent",

  async execute(input, ctx) {
    // input is typed as Input
    const response = await generateResponse(input.prompt);

    return {
      response,
      tokenCount: response.length
    };
  }
};
```

## Register as Flow Node

```typescript
import { NodeRegistry, executeFlow, parseFlowYaml, createHub } from "@open-harness/kernel";

const registry = new NodeRegistry();

// Register agent as a node type
registry.register({
  type: "my-agent",
  ...myAgent,
  inputSchema: z.object({ data: z.string() }),
  outputSchema: z.object({ result: z.string() }),
});

// Use in flow
const flow = parseFlowYaml(`
name: agent-flow
nodes:
  - id: process
    type: my-agent
    input:
      data: "{{flow.input.userInput}}"
`);

const hub = createHub();
const result = await executeFlow(flow, registry, { hub }, { userInput: "Hello!" });
```

## Access Hub in Agent

```typescript
async execute(input, ctx) {
  // Emit events
  ctx.hub.emit({ type: "narrative", text: "Processing..." });

  // Emit streaming output
  for await (const chunk of streamResponse(input)) {
    ctx.hub.emit({ type: "agent:text", content: chunk });
  }

  return { done: true };
}
```

## Multi-Turn Agent

For interactive agents that receive messages during execution:

```typescript
const chatAgent: AgentDefinition = {
  name: "chat-agent",

  async execute(input, ctx) {
    const messages: string[] = [];

    // Subscribe to session messages for this run
    const unsubscribe = ctx.hub.subscribe("session:message", (event) => {
      if (event.context.runId === ctx.runId) {
        messages.push(event.event.content);

        ctx.hub.emit({
          type: "agent:text",
          content: `Echo: ${event.event.content}`,
        });
      }
    });

    // Wait for session to complete
    await waitForComplete(ctx.hub);
    unsubscribe();

    return { messages };
  }
};
```

## Custom Lifecycle Events

When `emitsStartComplete: true`, the agent handles its own lifecycle events:

```typescript
const customAgent: AgentDefinition = {
  name: "custom-agent",
  emitsStartComplete: true,

  async execute(input, ctx) {
    ctx.hub.emit({
      type: "agent:start",
      agentName: "custom-agent",
    });

    try {
      const result = await doWork(input);

      ctx.hub.emit({
        type: "agent:complete",
        agentName: "custom-agent",
        success: true,
      });

      return result;
    } catch (error) {
      ctx.hub.emit({
        type: "agent:complete",
        agentName: "custom-agent",
        success: false,
      });
      throw error;
    }
  }
};
```

## Related

- [Claude Agent](/docs/guides/agents/anthropic-agent) - Use Claude provider
- [AgentDefinition Reference](/docs/reference/types/agent-definition) - Full reference
- [Hub Events](/docs/learn/hub-events) - Event subscription
