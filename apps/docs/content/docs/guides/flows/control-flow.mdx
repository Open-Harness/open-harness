---
title: Control Flow
description: Build complex flow logic with branching and conditional edges
---

# Control Flow

Create sophisticated workflows with branching and conditional execution.

## Sequential Execution

Connect nodes with edges to create a sequence:

```yaml
nodes:
  - id: step1
    type: claude.agent
    input:
      prompt: "First step"

  - id: step2
    type: claude.agent
    input:
      prompt: "Uses {{ step1.text }}"

edges:
  - from: step1
    to: step2
```

## Branching

Use `when` clauses on edges for different paths:

```yaml
nodes:
  - id: router
    type: claude.agent
    input:
      prompt: |
        Classify this query. Return ONLY "A" or "B":
        {{ flow.input.query }}

  - id: path-a
    type: claude.agent
    input:
      prompt: "Handle type A query"

  - id: path-b
    type: claude.agent
    input:
      prompt: "Handle type B query"

edges:
  - from: router
    to: path-a
    when: "$contains(router.text, 'A')"

  - from: router
    to: path-b
    when: "$contains(router.text, 'B')"
```

## Conditional Expressions

Use JSONata expressions in `when` clauses:

```yaml
# String matching
when: "$contains(router.text, 'urgent')"

# Equality check
when: "classify.category = 'bug'"

# Numeric comparison
when: "score.value > 0.8"

# Negation
when: "$not($contains(router.text, 'skip'))"
```

## Convergence

Multiple paths can join at a single node:

```yaml
nodes:
  - id: analyze
    type: claude.agent
    input:
      prompt: "Analyze: {{ flow.input.text }}"

  - id: path-a
    type: claude.agent
    input:
      prompt: "Path A processing"

  - id: path-b
    type: claude.agent
    input:
      prompt: "Path B processing"

  - id: final
    type: claude.agent
    input:
      prompt: |
        Combine the results:
        Analysis: {{ analyze.text }}

edges:
  - from: analyze
    to: path-a
    when: "$contains(analyze.text, 'option-a')"

  - from: analyze
    to: path-b
    when: "$contains(analyze.text, 'option-b')"

  - from: path-a
    to: final

  - from: path-b
    to: final
```

The `final` node executes after whichever path completes.

<Callout type="tip" title="Tip">
When multiple edges lead to the same node, that node waits for ALL incoming edges to complete before executing.
</Callout>

## Binding Syntax

Reference node outputs with `{{ nodeId.field }}`:

```yaml
# Access previous node output
input:
  data: "{{ previousNode.text }}"

# Access nested fields
input:
  value: "{{ api.response.data.items[0].name }}"

# Access flow input
input:
  name: "{{ flow.input.userName }}"
```

## Next Steps

- [Conditionals](/docs/guides/expressions/conditionals) — Expression-based conditions
- [Bindings](/docs/guides/expressions/bindings) — Data flow between nodes
- [Flow Definition](/docs/reference/types/flow-definition) — Complete flow schema

