---
title: Troubleshooting
description: Common errors and how to fix them
---

# Troubleshooting

Common errors and their solutions.

## Installation Errors

### Cannot find module '@open-harness/core'

```
Error: Cannot find module '@open-harness/core'
```

**Cause:** Dependencies not installed.

**Fix:** Run the install command:

```bash
bun install
```

### Cannot find module '@open-harness/vitest'

```
Error: Cannot find module '@open-harness/vitest'
```

**Cause:** Vitest plugin not installed.

**Fix:** Install the Vitest plugin:

```bash
bun add -D @open-harness/vitest vitest
```

## Configuration Errors

### State type mismatch

```
Type 'string' is not assignable to type 'null'
```

**Cause:** Initial state doesn't match the `TState` type parameter.

**Fix:** Ensure your state matches your type definition:

```typescript
// Define your state type
type State = { input: string; result: string | null };

// Create harness with correct type
const { agent, runReactive } = createHarness<State>();

// Initial state must match
const result = await runReactive({
  agents: { myAgent },
  state: { input: "Hello", result: null }, // âœ“ Correct
  provider: new ClaudeProvider(),
});
```

### Invalid activateOn pattern

```
Error: Invalid signal pattern: "invalid"
```

**Cause:** Signal pattern doesn't match expected format.

**Fix:** Use valid signal patterns:

```typescript
// Valid patterns
activateOn: ["harness:start"]
activateOn: ["agent:completed"]
activateOn: ["analysis:complete"]  // Custom signal
activateOn: ["state:result:changed"]
```

### No provider configured

```
Error: No provider configured for agent
```

**Cause:** Missing provider in `runReactive` config.

**Fix:** Pass a provider:

```typescript
import { createHarness, ClaudeProvider } from "@open-harness/core";

const result = await runReactive({
  agents: { myAgent },
  state: initialState,
  provider: new ClaudeProvider(), // Required
});
```

## Runtime Errors

### Workflow never terminates

**Cause:** `endWhen` condition never returns `true` and signals stop flowing.

**Fix:** Check your termination condition:

```typescript
const result = await runReactive({
  agents: { analyzer },
  state: { input: "Hello", result: null },
  provider,
  // Ensure this becomes true
  endWhen: (state) => state.result !== null,
});
```

Or add a timeout:

```typescript
const result = await runReactive({
  agents: { analyzer },
  state: initialState,
  provider,
  timeout: 30000, // 30 second safety net
});
```

### Agent not activating

**Cause:** The `activateOn` signal was never emitted, or `when` guard returned false.

**Fix:** Check your signal chain:

```typescript
// Agent waits for analysis:complete
const reviewer = agent({
  prompt: "Review the analysis",
  activateOn: ["analysis:complete"],
});

// But analyzer doesn't emit it!
const analyzer = agent({
  prompt: "Analyze input",
  activateOn: ["harness:start"],
  // Missing: emits: ["analysis:complete"]
});
```

Add the `emits` declaration:

```typescript
const analyzer = agent({
  prompt: "Analyze input",
  activateOn: ["harness:start"],
  emits: ["analysis:complete"], // Now reviewer will activate
});
```

### State not updating

**Cause:** Agent doesn't have `updates` field.

**Fix:** Specify which state key to update:

```typescript
const analyzer = agent({
  prompt: "Analyze: {{ state.input }}",
  activateOn: ["harness:start"],
  updates: "result", // Agent output goes to state.result
});
```

### Agent guard always false

```typescript
// This agent never runs
const reviewer = agent({
  prompt: "Review",
  activateOn: ["analysis:complete"],
  when: (state) => state.needsReview === true,
});
```

**Cause:** `when` guard condition never met.

**Fix:** Ensure state has the expected shape:

```typescript
// Make sure needsReview can become true
type State = {
  analysis: string | null;
  needsReview: boolean;
};
```

## Provider Errors

### Authentication failed

```
Error: Claude API authentication failed
```

**Cause:** Running outside Claude Code environment.

**Fix:** Open Harness uses Claude Code subscription authentication. Run your code from within Claude Code:

```bash
# From Claude Code terminal
bun run agent.ts
```

<Callout type="note" title="Authentication">
Open Harness uses your Claude Code subscription for authentication. No API key is required when running from Claude Code.
</Callout>

### Rate limit exceeded

```
Error: Rate limit exceeded
```

**Cause:** Too many requests in a short period.

**Fix:** The error signal includes retry information:

```typescript
const errors = result.signals.filter(s => s.name === "provider:error");
for (const error of errors) {
  if (error.payload.retryAfter) {
    console.log(`Retry after ${error.payload.retryAfter} seconds`);
  }
}
```

### Provider error in signal trace

```typescript
const result = await runReactive({ /* ... */ });

const errors = result.signals.filter(s => s.name === "provider:error");
if (errors.length > 0) {
  console.error("Provider errors:", errors);
}
```

## Test Errors

### Matcher not recognized

```
TypeError: expect(...).toContainSignal is not a function
```

**Cause:** Vitest matchers not registered.

**Fix:** Add the setup file to your Vitest config:

```typescript title="vitest.config.ts"
import { defineConfig } from "vitest/config";

export default defineConfig({
  test: {
    setupFiles: ["@open-harness/vitest/setup"],
  },
});
```

Or manually register in your test:

```typescript
import { expect } from "vitest";
import { toContainSignal, toHaveSignalsInOrder } from "@open-harness/vitest";

expect.extend({ toContainSignal, toHaveSignalsInOrder });
```

### Test timeout

```
Error: Test timed out after 5000ms
```

**Cause:** Agent execution takes longer than the default timeout.

**Fix:** Increase the test timeout:

```typescript
import { test } from "vitest";

test("slow agent test", async () => {
  // Test code here
}, 30000); // 30 second timeout
```

### Signal assertion failed

```
Expected signals to contain "analysis:complete" but it was not found
```

**Fix:** Debug by logging all signals:

```typescript
const result = await runReactive({ /* ... */ });

console.log("All signals:", result.signals.map(s => s.name));

expect(result.signals).toContainSignal("analysis:complete");
```

## Recording/Replay Errors

### Recording not found

```
Error: Recording 'rec_abc123' not found
```

**Cause:** Trying to replay a recording that doesn't exist.

**Fix:** Record first, then replay:

```typescript
const store = new MemorySignalStore();

// Record
const result = await runReactive({
  agents: { analyzer },
  state: initialState,
  provider: new ClaudeProvider(),
  recording: { mode: "record", store },
});

const recordingId = result.recordingId;

// Replay with the same ID
const replay = await runReactive({
  agents: { analyzer },
  state: initialState,
  provider: new ClaudeProvider(),
  recording: { mode: "replay", store, recordingId },
});
```

### Replay state mismatch

```
Error: Replay state doesn't match recorded state
```

**Cause:** Initial state differs from when recording was made.

**Fix:** Use the same initial state for replay:

```typescript
const initialState = { input: "Hello", result: null };

// Same state for both
const record = await runReactive({
  state: initialState,
  recording: { mode: "record", store },
});

const replay = await runReactive({
  state: initialState, // Must match!
  recording: { mode: "replay", store, recordingId },
});
```

## Debugging Tips

### Enable signal tracing

```typescript
const result = await runReactive({ /* ... */ });

// Log signal flow
for (const signal of result.signals) {
  console.log(`[${signal.timestamp}] ${signal.name}`, signal.payload);
}
```

### Check agent activations

```typescript
const activations = result.signals.filter(s => s.name === "agent:activated");
console.log("Agents that ran:", activations.map(s => s.payload.agent));

const skipped = result.signals.filter(s => s.name === "agent:skipped");
console.log("Agents skipped:", skipped.map(s => `${s.payload.agent}: ${s.payload.reason}`));
```

### Inspect final state

```typescript
console.log("Final state:", result.state);
console.log("Duration:", result.metrics.durationMs, "ms");
console.log("Agent activations:", result.metrics.activations);
console.log("Terminated early:", result.terminatedEarly);
```

## Still Stuck?

If your error isn't listed here:

1. Check the [API Reference](/docs/reference/api/runtime) for correct function signatures
2. Look at the [Quickstart](/docs/learn/quickstart) for working examples
3. Review the [Signal System](/docs/concepts/event-system) for signal patterns
