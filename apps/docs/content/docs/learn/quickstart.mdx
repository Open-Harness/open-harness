---
title: Quickstart
description: Build your first Open Harness agent in 5 minutes
---

# Quickstart

Build and run an agent with Claude in under five minutes, then add fixtures for free, instant test replay.

## What You'll Build

A code review assistant with metrics tracking and fixture-based testing:

```
Input → [Code Reviewer Agent] → Output + Metrics (latency, cost, tokens)
```

## Prerequisites

- Bun 1.0+
- Running inside Claude Code (for authentication)

## Step 1: Create a Project

```bash
mkdir code-reviewer && cd code-reviewer
bun init -y
bun add @open-harness/core @open-harness/server @open-harness/stores
```

## Step 2: Define the Agent

Create `agent.ts`:

```typescript title="agent.ts"
import { agent, run, setDefaultProvider } from "@open-harness/core";
import { createClaudeNode } from "@open-harness/server";

// Configure provider (auth handled by Claude Code subscription)
setDefaultProvider(createClaudeNode());

// Define your agent with a system prompt
const codeReviewer = agent({
  prompt: `You are an expert code reviewer. Analyze code for:
- Bugs and edge cases
- Security vulnerabilities
- Performance issues

Format your response as:
## Issues
[List issues with severity: HIGH/MEDIUM/LOW]

## Verdict
APPROVE or REQUEST_CHANGES`,
});

// Run the agent
const result = await run(codeReviewer, {
  prompt: `Review this code:
function divide(a, b) {
  return a / b;
}`,
});

console.log("Review:", result.output);
console.log("Latency:", result.metrics.latencyMs, "ms");
console.log("Cost: $", result.metrics.cost.toFixed(4));
```

## Step 3: Run It

```bash
bun run agent.ts
```

Expected output:

```
Review: ## Issues
- **HIGH**: Division by zero - no check for b === 0

## Verdict
REQUEST_CHANGES

Latency: 2341 ms
Cost: $ 0.0023
```

## Step 4: Add State

Agents can track state across runs:

```typescript title="agent-with-state.ts"
interface ReviewerState {
  reviewCount: number;
  issuesFound: number;
}

const codeReviewer = agent({
  prompt: "Review code for bugs and security issues.",
  state: {
    reviewCount: 0,
    issuesFound: 0,
  } as ReviewerState,
});

const result = await run(codeReviewer, { prompt: "..." });
console.log("State:", result.state); // { reviewCount: 0, issuesFound: 0 }
```

## Step 5: Add Fixtures for Testing

Fixtures record LLM responses so tests are **free and instant** on replay.

Create `test-utils.ts`:

```typescript title="test-utils.ts"
import { FileRecordingStore } from "@open-harness/stores";
import { setDefaultStore, setDefaultMode } from "@open-harness/core";

export const fixtureStore = new FileRecordingStore({
  directory: "./fixtures",
});

export function setupFixtures(): void {
  setDefaultStore(fixtureStore);
  if (!process.env.FIXTURE_MODE) {
    setDefaultMode("replay"); // Default to replay (fast, free)
  }
}

export function withFixture(name: string) {
  return { fixture: name, store: fixtureStore };
}
```

Create `agent.test.ts`:

```typescript title="agent.test.ts"
import { describe, expect, it, beforeAll } from "bun:test";
import { agent, run, setDefaultProvider } from "@open-harness/core";
import { createClaudeNode } from "@open-harness/server";
import { setupFixtures, withFixture } from "./test-utils";

beforeAll(() => {
  setDefaultProvider(createClaudeNode());
  setupFixtures();
});

const codeReviewer = agent({
  prompt: "Review code for bugs and security issues.",
});

describe("Code Reviewer", () => {
  it("catches division by zero", async () => {
    const result = await run(
      codeReviewer,
      { prompt: "function divide(a, b) { return a / b; }" },
      withFixture("division-review"), // Name this fixture
    );

    expect(result.output).toContain("division");
    expect(result.metrics.latencyMs).toBeGreaterThanOrEqual(0);
  }, { timeout: 180000 });
});
```

Run tests:

```bash
# First run: record fixtures (costs ~$0.01)
FIXTURE_MODE=record bun test

# Subsequent runs: replay fixtures (free, instant)
bun test
```

## What You Learned

| Concept | Description |
|---------|-------------|
| `agent()` | Creates an agent with a system prompt |
| `run()` | Executes agent, returns `{ output, metrics, state }` |
| `metrics` | Automatic tracking of latency, cost, tokens |
| `state` | Optional typed state returned with each run |
| `withFixture()` | Records LLM response for deterministic replay |

## Fixture Modes

| Mode | Behavior | When to Use |
|------|----------|-------------|
| `replay` | Load saved response | CI, normal development |
| `record` | Execute live, save response | First run, after prompt changes |
| `live` | Execute live, don't save | Debugging |

## Troubleshooting

<Callout type="stuck" title="Common Issues">
**Cannot find module '@open-harness/core'**
```bash
bun install
```

**Authentication failed**
Run from within Claude Code - authentication uses Claude Code subscription.

**Test timeout**
LLM calls take 30-60s. Use `{ timeout: 180000 }` or fixtures for instant replay.

**Fixture not found**
Run with `FIXTURE_MODE=record` first to create the fixture.
</Callout>

## Next Steps

<Cards>
  <Card title="SpecKit Tutorial" href="/docs/learn/speckit-tutorial">
    7-level progressive tutorial from basic agents to CI quality gates
  </Card>
  <Card title="Multi-Agent Harness" href="/docs/learn/speckit-tutorial#level-4-multi-agent-harness">
    Compose multiple agents with harness()
  </Card>
  <Card title="Architecture" href="/docs/concepts/architecture">
    Understand how Open Harness works internally
  </Card>
</Cards>
