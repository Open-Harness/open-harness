# Ralphy Task List
# Source: .ralphy/PRD.md
# Generated: 2026-01-20

metadata:
  name: "Signal Adapter Refactor - Pure Data Signals"
  total_tasks: 18
  total_phases: 6

tasks:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # Phase 1: Remove Display from Signal Core
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - title: "1.1: Remove display types from signal.ts (TR-1.1)"
    completed: true
    parallel_group: 1
    phase: "Phase 1: Remove Display from Signal Core"
    details: |
      CONTEXT:
      Current Signal interface couples data with presentation via display field.
      This violates the principle "Signals are data, not presentation".
      We need to make Signal a pure data structure.

      LOCATION: packages/internal/signals-core/src/signal.ts

      STEPS:
      1. Read packages/internal/signals-core/src/signal.ts
      2. Remove SignalDisplayType type
      3. Remove SignalDisplayStatus type
      4. Remove SignalDisplay interface
      5. Remove display field from Signal interface
      6. Remove display field from CreateSignalOptions
      7. Remove display-related logic in createSignal()
      8. Keep SignalSource (still useful for debugging)

      CONSTITUTION COMPLIANCE:
      - Per MUST-004: Explicit verification commands below
      - This is a refactor, not new functionality requiring real API testing

      VERIFY:
      ```bash
      bun run typecheck  # Must pass with zero errors
      grep -n "SignalDisplay" packages/internal/signals-core/src/signal.ts  # Should return no matches
      grep -n "display:" packages/internal/signals-core/src/signal.ts  # Should only match comments if any
      ```
    verify:
      - command: "bun run typecheck"
        expect: "Zero type errors"
      - command: "grep -n 'SignalDisplay' packages/internal/signals-core/src/signal.ts"
        expect: "No matches (empty output)"
    acceptance:
      - "Signal interface has no display field"
      - "All display-related types removed from signal.ts"
      - "Typecheck passes with zero errors"

  - title: "1.2: Remove display/meta from defineSignal() (TR-1.2)"
    completed: true
    parallel_group: 1
    phase: "Phase 1: Remove Display from Signal Core"
    details: |
      CONTEXT:
      defineSignal() currently accepts display and meta config that gets copied to signals.
      The meta field is dead code - never actually copied to signals despite logsAdapter casts.
      Remove both to simplify the API.

      LOCATION: packages/internal/signals-core/src/define-signal.ts

      STEPS:
      1. Read packages/internal/signals-core/src/define-signal.ts
      2. Remove SignalDisplayConfig interface
      3. Remove SignalMeta interface (dead code)
      4. Remove display and meta from DefineSignalConfig
      5. Remove displayConfig and meta from SignalDefinition
      6. Remove convertToSignalDisplay() function
      7. Remove all display-related logic in create() method

      CONSTITUTION COMPLIANCE:
      - Per MUST-004: Explicit verification commands below

      VERIFY:
      ```bash
      bun run typecheck  # Must pass with zero errors
      grep -n "SignalDisplayConfig\|SignalMeta\|convertToSignalDisplay" packages/internal/signals-core/src/define-signal.ts  # No matches
      grep -n "display:\|meta:" packages/internal/signals-core/src/define-signal.ts  # Only in comments if any
      ```
    verify:
      - command: "bun run typecheck"
        expect: "Zero type errors"
      - command: "grep -n 'SignalDisplayConfig\\|SignalMeta\\|convertToSignalDisplay' packages/internal/signals-core/src/define-signal.ts"
        expect: "No matches"
    acceptance:
      - "defineSignal() has no display or meta config"
      - "All display/meta types removed"
      - "Typecheck passes"

  - title: "1.3: Update signals-core exports (TR-1.3)"
    completed: true
    parallel_group: 1
    phase: "Phase 1: Remove Display from Signal Core"
    details: |
      CONTEXT:
      Clean up public exports to remove display-related types.

      LOCATION: packages/internal/signals-core/src/index.ts

      STEPS:
      1. Read packages/internal/signals-core/src/index.ts
      2. Remove SignalDisplay export
      3. Remove SignalDisplayType export
      4. Remove SignalDisplayStatus export
      5. Remove SignalDisplayConfig export
      6. Remove SignalMeta export

      CONSTITUTION COMPLIANCE:
      - Per MUST-004: Explicit verification commands below

      VERIFY:
      ```bash
      bun run typecheck  # Must pass
      grep -n "SignalDisplay\|SignalDisplayType\|SignalDisplayStatus\|SignalDisplayConfig\|SignalMeta" packages/internal/signals-core/src/index.ts  # No matches
      ```
    verify:
      - command: "bun run typecheck"
        expect: "Zero type errors"
      - command: "grep -n 'SignalDisplay\\|SignalDisplayType\\|SignalDisplayStatus\\|SignalDisplayConfig\\|SignalMeta' packages/internal/signals-core/src/index.ts"
        expect: "No matches"
    acceptance:
      - "No display-related exports in index.ts"
      - "Typecheck passes"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # Phase 2: Refactor Terminal Adapter
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - title: "2.1: Add RendererMap type to terminal adapter (TR-2.1)"
    completed: true
    parallel_group: 2
    phase: "Phase 2: Refactor Terminal Adapter"
    details: |
      CONTEXT:
      Invert responsibility: adapters define how to render signals, not signals themselves.
      Add types for renderer functions and maps.

      LOCATION: packages/internal/signals/src/adapters/terminal.ts

      STEPS:
      1. Read packages/internal/signals/src/adapters/terminal.ts
      2. Add SignalRenderer<T = unknown> type (receives Signal<T>, returns string)
      3. Add RendererMap type (Record<string, SignalRenderer>)
      4. Add JSDoc explaining that renderers are functions mapping signals to terminal strings
      5. Add JSDoc explaining that signals not in map are silently skipped

      CONSTITUTION COMPLIANCE:
      - Per MUST-004: Explicit verification commands below

      VERIFY:
      ```bash
      bun run typecheck  # Must pass
      grep -n "export type SignalRenderer" packages/internal/signals/src/adapters/terminal.ts  # Must find definition
      grep -n "export type RendererMap" packages/internal/signals/src/adapters/terminal.ts  # Must find definition
      ```
    verify:
      - command: "bun run typecheck"
        expect: "Zero type errors"
      - command: "grep -n 'export type SignalRenderer' packages/internal/signals/src/adapters/terminal.ts"
        expect: "Found at least one match"
      - command: "grep -n 'export type RendererMap' packages/internal/signals/src/adapters/terminal.ts"
        expect: "Found at least one match"
    acceptance:
      - "SignalRenderer and RendererMap types exported"
      - "Types properly documented"
      - "Typecheck passes"

  - title: "2.2: Refactor terminalAdapter to accept renderers (TR-2.2)"
    completed: true
    parallel_group: 2
    phase: "Phase 2: Refactor Terminal Adapter"
    details: |
      CONTEXT:
      Change terminalAdapter signature to accept a renderers map.
      Lookup renderers by signal name - if found, render; if not, skip silently.

      LOCATION: packages/internal/signals/src/adapters/terminal.ts

      STEPS:
      1. Read packages/internal/signals/src/adapters/terminal.ts
      2. Define TerminalAdapterOptions interface with:
         - renderers: RendererMap (required)
         - write?: (text: string) => void (optional, defaults to console.log)
         - showTimestamp?: boolean (optional)
         - colors?: boolean (optional)
      3. Change terminalAdapter signature to accept TerminalAdapterOptions
      4. In adapter implementation:
         - Look up renderers[signal.name]
         - If found: call renderer(signal), write output
         - If not found: return early (skip silently, no output, no error)
      5. Remove signal.display access (no longer exists)
      6. Keep timestamp/color formatting logic if applicable

      CONSTITUTION COMPLIANCE:
      - Per MUST-004: Explicit verification commands below

      VERIFY:
      ```bash
      bun run typecheck  # Must pass
      grep -n "signal.display" packages/internal/signals/src/adapters/terminal.ts  # Should return no matches
      grep -n "renderers:" packages/internal/signals/src/adapters/terminal.ts  # Should find in options interface
      ```
    verify:
      - command: "bun run typecheck"
        expect: "Zero type errors"
      - command: "grep -n 'signal.display' packages/internal/signals/src/adapters/terminal.ts"
        expect: "No matches"
    acceptance:
      - "terminalAdapter accepts TerminalAdapterOptions with renderers"
      - "Signals with renderers are rendered and written"
      - "Signals without renderers are skipped silently"
      - "No signal.display references remain"

  - title: "2.3: Remove inference logic from terminal adapter (TR-2.3)"
    completed: true
    parallel_group: 2
    phase: "Phase 2: Refactor Terminal Adapter"
    details: |
      CONTEXT:
      Remove all fallback/inference logic - adapters should only use explicit renderers.
      No more magic behavior.

      LOCATION: packages/internal/signals/src/adapters/terminal.ts

      STEPS:
      1. Read packages/internal/signals/src/adapters/terminal.ts
      2. Delete inferDisplayFromName() function
      3. Delete resolveTitle() function
      4. Delete resolveSubtitle() function
      5. Delete formatProgress() function
      6. Remove all display type/status logic
      7. Simplify to: renderer returns string â†’ write to output (if renderer exists)

      CONSTITUTION COMPLIANCE:
      - Per MUST-004: Explicit verification commands below

      VERIFY:
      ```bash
      bun run typecheck  # Must pass
      grep -n "inferDisplayFromName\|resolveTitle\|resolveSubtitle\|formatProgress" packages/internal/signals/src/adapters/terminal.ts  # No matches
      ```
    verify:
      - command: "bun run typecheck"
        expect: "Zero type errors"
      - command: "grep -n 'inferDisplayFromName\\|resolveTitle\\|resolveSubtitle\\|formatProgress' packages/internal/signals/src/adapters/terminal.ts"
        expect: "No matches"
    acceptance:
      - "All inference functions removed"
      - "Terminal adapter only uses explicit renderers"
      - "Typecheck passes"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # Phase 3: Refactor Logs Adapter
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - title: "3.1: Simplify logsAdapter (TR-3.1)"
    completed: true
    parallel_group: 3
    phase: "Phase 3: Refactor Logs Adapter"
    details: |
      CONTEXT:
      The logsAdapter had a SignalWithMeta interface that was a lie - meta was never
      actually copied to signals. Remove the lie, keep name-based inference for routing.

      LOCATION: packages/internal/signals/src/adapters/logs.ts

      STEPS:
      1. Read packages/internal/signals/src/adapters/logs.ts
      2. Remove SignalWithMeta interface (never actually existed on signals)
      3. Remove getLogLevel() checks for meta.level (never worked)
      4. Keep inferLevelFromName() - name-based log level routing is fine for this adapter
      5. Keep pattern matching (*:error â†’ error level, etc.)
      6. Ensure adapter routes signals to appropriate Pino log levels based on name patterns

      CONSTITUTION COMPLIANCE:
      - Per MUST-004: Explicit verification commands below

      VERIFY:
      ```bash
      bun run typecheck  # Must pass
      grep -n "SignalWithMeta\|meta.level" packages/internal/signals/src/adapters/logs.ts  # No matches
      grep -n "inferLevelFromName" packages/internal/signals/src/adapters/logs.ts  # Should find - we keep this
      ```
    verify:
      - command: "bun run typecheck"
        expect: "Zero type errors"
      - command: "grep -n 'SignalWithMeta\\|meta.level' packages/internal/signals/src/adapters/logs.ts"
        expect: "No matches"
      - command: "grep -n 'inferLevelFromName' packages/internal/signals/src/adapters/logs.ts"
        expect: "Found at least one match (we keep this)"
    acceptance:
      - "SignalWithMeta and meta.level removed"
      - "inferLevelFromName() retained for name-based routing"
      - "Typecheck passes"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # Phase 4: Update PRD Workflow
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - title: "4.1: Remove display from PRD signal definitions (TR-4.1)"
    completed: true
    parallel_group: 4
    phase: "Phase 4: Update PRD Workflow"
    details: |
      CONTEXT:
      PRD workflow has 13 signal definitions with display/meta config.
      Remove all of that - keep only name and schema.

      LOCATION: packages/prd-workflow/src/signals/index.ts

      STEPS:
      1. Read packages/prd-workflow/src/signals/index.ts
      2. For all 13 signal definitions, remove:
         - meta: { level, category }
         - display: { type, title, subtitle, icon, status }
      3. Keep only:
         - name
         - schema
      4. Ensure all signals still have proper Zod schemas for validation

      CONSTITUTION COMPLIANCE:
      - Per MUST-004: Explicit verification commands below

      VERIFY:
      ```bash
      bun run typecheck  # Must pass
      grep -n "meta:\|display:" packages/prd-workflow/src/signals/index.ts  # Should return no matches (except in comments)
      grep -c "defineSignal" packages/prd-workflow/src/signals/index.ts  # Should still be 13
      ```
    verify:
      - command: "bun run typecheck"
        expect: "Zero type errors"
      - command: "grep -n 'meta:\\|display:' packages/prd-workflow/src/signals/index.ts"
        expect: "No matches or only in comments"
      - command: "grep -c 'defineSignal' packages/prd-workflow/src/signals/index.ts"
        expect: "13 (all signal definitions remain)"
    acceptance:
      - "All 13 signals have no meta or display config"
      - "All signals retain name and schema"
      - "Typecheck passes"

  - title: "4.2: Create renderer map for PRD workflow (TR-4.2)"
    completed: true
    parallel_group: 4
    phase: "Phase 4: Update PRD Workflow"
    details: |
      CONTEXT:
      Create a renderer map that defines how to display PRD workflow signals in terminal.
      This moves presentation logic from signals to adapter configuration.

      LOCATION: packages/prd-workflow/src/renderers.ts (new file) or packages/prd-workflow/src/cli.ts

      STEPS:
      1. Create packages/prd-workflow/src/renderers.ts
      2. Import RendererMap from @internal/signals
      3. Export prdRenderers: RendererMap with renderers for all 13 signals:
         - "plan:start": () => "ğŸ“‹ Planning..."
         - "plan:created": (s) => `âœ“ Plan created with ${s.payload.tasks.length} tasks (${s.payload.milestones.length} milestones)`
         - "task:ready": (s) => `â–¶ ${s.payload.title}`
         - "task:complete": (s) => `${s.payload.outcome === "success" ? "âœ“" : "âœ—"} Task ${s.payload.taskId} ${s.payload.outcome}`
         - "task:approved": (s) => `âœ“ Task ${s.payload.taskId ?? ""} approved`
         - "discovery:submitted": (s) => `ğŸ” ${s.payload.count} task${s.payload.count === 1 ? "" : "s"} discovered`
         - "discovery:reviewed": (s) => `âœ“ ${s.payload.accepted} accepted, ${s.payload.rejected} rejected`
         - "milestone:testable": (s) => `ğŸ§ª Testing milestone ${s.payload.milestoneId}`
         - "milestone:passed": (s) => `âœ“ Milestone ${s.payload.milestoneId} passed`
         - "milestone:failed": (s) => `âœ— Milestone ${s.payload.milestoneId} failed`
         - "milestone:retry": (s) => `ğŸ”„ Retrying milestone ${s.payload.milestoneId}`
         - "fix:required": (s) => `ğŸ”§ Fixing task ${s.payload.taskId} (attempt ${s.payload.attempt})`
         - "workflow:complete": (s) => `ğŸ‰ ${s.payload.reason === "all_milestones_passed" ? "All milestones passed!" : s.payload.reason}`
      4. Use proper TypeScript types for signal payloads

      CONSTITUTION COMPLIANCE:
      - Per MUST-004: Explicit verification commands below

      VERIFY:
      ```bash
      bun run typecheck  # Must pass
      grep -c "\"plan:start\"\|\"plan:created\"\|\"task:ready\"" packages/prd-workflow/src/renderers.ts  # At least 3 renderers
      ```
    verify:
      - command: "bun run typecheck"
        expect: "Zero type errors"
      - command: "test -f packages/prd-workflow/src/renderers.ts"
        expect: "File exists"
    acceptance:
      - "prdRenderers exported with all 13 signal renderers"
      - "Each renderer accesses appropriate payload fields with type safety"
      - "Typecheck passes"

  - title: "4.3: Update PRD CLI to pass renderers (TR-4.3)"
    completed: true
    parallel_group: 4
    phase: "Phase 4: Update PRD Workflow"
    details: |
      CONTEXT:
      Wire up the renderer map to the terminal adapter in the CLI.

      LOCATION: packages/prd-workflow/src/cli.ts

      STEPS:
      1. Read packages/prd-workflow/src/cli.ts
      2. Import prdRenderers from ./renderers.ts
      3. Find where terminalAdapter() is called
      4. Update to: terminalAdapter({ renderers: prdRenderers })
      5. Keep logsAdapter({ logger }) unchanged (it uses name-based routing)

      CONSTITUTION COMPLIANCE:
      - Per MUST-004: Explicit verification commands below

      VERIFY:
      ```bash
      bun run typecheck  # Must pass
      grep -n "terminalAdapter.*renderers.*prdRenderers" packages/prd-workflow/src/cli.ts  # Should find the call
      grep -n "import.*prdRenderers" packages/prd-workflow/src/cli.ts  # Should find the import
      ```
    verify:
      - command: "bun run typecheck"
        expect: "Zero type errors"
      - command: "grep -n 'terminalAdapter.*renderers.*prdRenderers' packages/prd-workflow/src/cli.ts"
        expect: "Found at least one match"
    acceptance:
      - "prdRenderers imported and passed to terminalAdapter"
      - "Typecheck passes"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # Phase 5: Cleanup
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - title: "5.1: Delete inference test file (TR-5.1)"
    completed: true
    parallel_group: 5
    phase: "Phase 5: Cleanup"
    details: |
      CONTEXT:
      No more inference logic means no need for inference tests.

      LOCATION: packages/internal/signals/src/adapters/terminal-inference.test.ts

      STEPS:
      1. Delete packages/internal/signals/src/adapters/terminal-inference.test.ts
      2. Verify file is gone

      CONSTITUTION COMPLIANCE:
      - Per MUST-004: Explicit verification commands below

      VERIFY:
      ```bash
      bun run typecheck  # Must pass
      test ! -f packages/internal/signals/src/adapters/terminal-inference.test.ts  # File should not exist
      ```
    verify:
      - command: "bun run typecheck"
        expect: "Zero type errors"
      - command: "test ! -f packages/internal/signals/src/adapters/terminal-inference.test.ts"
        expect: "File does not exist (exit code 0)"
    acceptance:
      - "terminal-inference.test.ts deleted"
      - "Typecheck passes"

  - title: "5.2: Update terminal adapter tests (TR-5.2)"
    completed: true
    parallel_group: 5
    phase: "Phase 5: Cleanup"
    details: |
      CONTEXT:
      Rewrite terminal adapter tests to use the new renderer map pattern.
      Tests should verify that only signals with renderers produce output.

      LOCATION: packages/internal/signals/src/adapters/terminal.test.ts

      STEPS:
      1. Read packages/internal/signals/src/adapters/terminal.test.ts
      2. Rewrite tests to:
         - Create a renderers map with specific signal names
         - Pass renderers to terminalAdapter()
         - Emit signals with names in the map â†’ verify output produced
         - Emit signals with names NOT in map â†’ verify no output, no error
         - Test custom write function receives correct formatted strings
         - Test timestamp and color options if applicable
      3. Remove any tests checking signal.display (no longer exists)
      4. Remove any tests checking inference behavior

      CONSTITUTION COMPLIANCE:
      - Per MUST-004: Explicit verification commands below
      - Per MUST-002: No rationalization language

      VERIFY:
      ```bash
      bun run typecheck  # Must pass
      bun test packages/internal/signals/src/adapters/terminal.test.ts  # All tests pass
      grep -n "signal.display\|inferDisplayFromName" packages/internal/signals/src/adapters/terminal.test.ts  # No matches
      ```
    verify:
      - command: "bun run typecheck"
        expect: "Zero type errors"
      - command: "bun test packages/internal/signals/src/adapters/terminal.test.ts"
        expect: "All tests pass"
      - command: "grep -n 'signal.display\\|inferDisplayFromName' packages/internal/signals/src/adapters/terminal.test.ts"
        expect: "No matches"
    acceptance:
      - "Tests verify renderer map behavior"
      - "Tests verify signals without renderers are skipped"
      - "No signal.display or inference references"
      - "All tests pass"

  - title: "5.3: Update signals README (TR-5.3)"
    completed: true
    parallel_group: 5
    phase: "Phase 5: Cleanup"
    details: |
      CONTEXT:
      Update documentation to reflect the new renderer map pattern.

      LOCATION: packages/internal/signals/README.md

      STEPS:
      1. Read packages/internal/signals/README.md
      2. Update adapter examples to show renderer map pattern
      3. Remove any references to signal.display
      4. Document that signals are pure data
      5. Document that adapters define rendering via renderer maps
      6. Add example showing terminalAdapter({ renderers: {...} })
      7. Explain that signals without renderers are skipped silently

      CONSTITUTION COMPLIANCE:
      - Per MUST-004: Explicit verification commands below

      VERIFY:
      ```bash
      bun run typecheck  # Must pass
      grep -n "renderers:" packages/internal/signals/README.md  # Should find examples
      grep -n "signal.display" packages/internal/signals/README.md  # Should not find (or only in migration notes)
      ```
    verify:
      - command: "bun run typecheck"
        expect: "Zero type errors"
      - command: "grep -n 'renderers:' packages/internal/signals/README.md"
        expect: "Found at least one example"
    acceptance:
      - "README shows renderer map pattern"
      - "No signal.display references in examples"
      - "Documentation explains pure data signals"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # Phase 6: Verification
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - title: "6.1: Verify typecheck passes (V-01)"
    completed: true
    parallel_group: 6
    phase: "Phase 6: Verification"
    details: |
      CONTEXT:
      Gate task to ensure all TypeScript types are correct after refactor.

      STEPS:
      1. Run full monorepo typecheck
      2. Verify zero errors

      CONSTITUTION COMPLIANCE:
      - Per MUST-004: Explicit verification commands below

      VERIFY:
      ```bash
      bun run typecheck  # Must complete with zero errors
      ```
    verify:
      - command: "bun run typecheck"
        expect: "Zero type errors, exit code 0"
    acceptance:
      - "Typecheck passes with zero errors across entire monorepo"

  - title: "6.2: Verify unit tests pass (V-02)"
    completed: true
    parallel_group: 6
    phase: "Phase 6: Verification"
    details: |
      CONTEXT:
      Gate task to ensure all tests pass after refactor.

      STEPS:
      1. Run full test suite
      2. Verify all tests pass

      CONSTITUTION COMPLIANCE:
      - Per MUST-004: Explicit verification commands below

      VERIFY:
      ```bash
      bun run test  # Must complete with all tests passing
      ```
    verify:
      - command: "bun run test"
        expect: "All tests pass, exit code 0"
    acceptance:
      - "All unit tests pass"
      - "No test failures or errors"

  - title: "6.3: Verify Signal interface is pure (V-03)"
    completed: true
    parallel_group: 6
    phase: "Phase 6: Verification"
    details: |
      CONTEXT:
      Verification task to ensure Signal interface has no display field.

      STEPS:
      1. Read packages/internal/signals-core/src/signal.ts
      2. Verify Signal interface definition
      3. Confirm no display field exists

      CONSTITUTION COMPLIANCE:
      - Per MUST-004: Explicit verification commands below

      VERIFY:
      ```bash
      grep -A 10 "interface Signal" packages/internal/signals-core/src/signal.ts | grep "display"  # Should return no matches
      ```
    verify:
      - command: "grep -A 10 'interface Signal' packages/internal/signals-core/src/signal.ts | grep 'display'"
        expect: "No matches (empty output)"
    acceptance:
      - "Signal interface has no display field"
      - "Signal is a pure data structure"

  - title: "6.4: Verify replay renders correctly (V-04)"
    completed: false
    parallel_group: 6
    phase: "Phase 6: Verification"
    details: |
      CONTEXT:
      Integration verification to ensure PRD workflow replay works with renderer map.
      Uses REAL recording replay, not mocks.

      LOCATION: packages/prd-workflow

      STEPS:
      1. Identify an existing recording ID in packages/prd-workflow recordings
      2. Run prd:replay with that recording
      3. Verify formatted output appears in terminal (via renderer map)
      4. Check that all 13 signal types render correctly

      CONSTITUTION COMPLIANCE:
      - Per MUST-001: Uses REAL recording replay, NO mocks
      - Per MUST-004: Explicit verification commands below

      CRITICAL: REAL REPLAY
      - Must use actual recording from packages/prd-workflow/.open-harness/recordings/
      - This verifies renderer map works with real workflow data

      VERIFY:
      ```bash
      cd packages/prd-workflow
      # Find a recording: ls .open-harness/recordings/
      bun run prd:replay --recording <RECORDING_ID>  # Must show formatted output with icons/colors
      ```
    verify:
      - command: "cd packages/prd-workflow && find .open-harness/recordings -name '*.jsonl' | head -1"
        expect: "At least one recording file exists"
    acceptance:
      - "Replay shows formatted output via renderer map"
      - "Signal names like plan:created render with icons and formatted text"
      - "No errors during replay"

  - title: "6.5: Verify unknown signals are skipped (V-05)"
    completed: false
    parallel_group: 6
    phase: "Phase 6: Verification"
    details: |
      CONTEXT:
      Create a test to verify that signals without renderers are silently skipped.
      This is part of the contract: no renderer = no output, no error.

      LOCATION: packages/internal/signals/src/adapters/terminal.test.ts

      STEPS:
      1. Add a test case:
         - Create renderers map with only "test:foo"
         - Emit "test:bar" (not in map)
         - Verify no output produced
         - Verify no error thrown
      2. Run the test

      CONSTITUTION COMPLIANCE:
      - Per MUST-004: Explicit verification commands below

      VERIFY:
      ```bash
      bun run typecheck  # Must pass
      bun test packages/internal/signals/src/adapters/terminal.test.ts -t "skip"  # Test with "skip" in name should pass
      ```
    verify:
      - command: "bun run typecheck"
        expect: "Zero type errors"
      - command: "bun test packages/internal/signals/src/adapters/terminal.test.ts"
        expect: "All tests pass"
    acceptance:
      - "Test added for unknown signal skipping"
      - "Test verifies no output and no error for signals without renderers"
      - "Test passes"

  - title: "6.6: Verify logs adapter still works (V-06)"
    completed: false
    parallel_group: 6
    phase: "Phase 6: Verification"
    details: |
      CONTEXT:
      Ensure logsAdapter still routes signals to correct Pino log levels after refactor.

      LOCATION: packages/internal/signals/src/adapters/logs.test.ts

      STEPS:
      1. Read packages/internal/signals/src/adapters/logs.test.ts
      2. Run logs adapter tests
      3. Verify name-based routing still works:
         - Signals with :error â†’ error level
         - Signals with :warn â†’ warn level
         - Default signals â†’ info level

      CONSTITUTION COMPLIANCE:
      - Per MUST-004: Explicit verification commands below

      VERIFY:
      ```bash
      bun run typecheck  # Must pass
      bun test packages/internal/signals/src/adapters/logs.test.ts  # All tests pass
      ```
    verify:
      - command: "bun run typecheck"
        expect: "Zero type errors"
      - command: "bun test packages/internal/signals/src/adapters/logs.test.ts"
        expect: "All tests pass"
    acceptance:
      - "logsAdapter tests pass"
      - "Name-based log level routing works correctly"
      - "No errors or failures"
