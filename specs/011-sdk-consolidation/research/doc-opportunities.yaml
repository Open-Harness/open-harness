# Documentation Opportunities Discovery
# Analysis of /Users/abuusama/projects/dao/dao-spec-kit/packages/sdk/src/

timestamp: 2025-12-28T07:15:00Z
agent: doc-finder
analyzed_paths:
  - packages/sdk/src/

# ============================================================================
# FOLDERS NEEDING README
# No src directories have README.md or index.md files
# ============================================================================

folders_needing_readme:
  - path: src/
    suggested_sections:
      - overview (three-layer architecture)
      - directory-structure
      - getting-started
      - api-levels (Level 1 wrapAgent, Level 2/3 defineHarness)
    priority: must
    reason: "Main entry point - index.ts has good JSDoc but no markdown docs"

  - path: src/harness/
    suggested_sections:
      - overview (orchestration layer)
      - file-list (23+ files)
      - event-systems-guide (FluentHarnessEvent vs UnifiedEvent)
      - state-management
      - renderer-system
      - transport-architecture
    priority: must
    reason: "Most complex directory - 23 files, multiple event systems, no guidance"

  - path: src/core/
    suggested_sections:
      - overview (infrastructure layer)
      - di-container-guide
      - event-buses (EventBus vs UnifiedEventBus)
      - tokens-reference
    priority: must
    reason: "DI container, event buses, tokens - foundational concepts need explanation"

  - path: src/core/unified-events/
    suggested_sections:
      - overview
      - event-types-catalog
      - type-guards
      - migration-from-legacy
    priority: should
    reason: "New event system - relationship to legacy EventBus unclear"

  - path: src/factory/
    suggested_sections:
      - overview
      - api-levels-guide
      - examples
    priority: should
    reason: "Entry points for users - defineHarness, wrapAgent, createAgent"

  - path: src/providers/
    suggested_sections:
      - overview
      - adding-new-providers
    priority: nice
    reason: "Single provider (Anthropic) - may need extension docs later"

  - path: src/providers/anthropic/agents/
    suggested_sections:
      - overview
      - base-class-guide
      - creating-custom-agents
      - agent-catalog
    priority: should
    reason: "BaseAnthropicAgent pattern needs examples for extension"

  - path: src/monologue/
    suggested_sections:
      - overview
      - decorator-usage
      - llm-integration
      - configuration
    priority: should
    reason: "Decorator pattern with LLM - complex feature needs user guide"

  - path: src/workflow/
    suggested_sections:
      - overview
      - task-list-guide
      - orchestrator-patterns
    priority: nice
    reason: "Small module but TaskList used throughout"

  - path: src/callbacks/
    suggested_sections:
      - overview
      - interface-guide
    priority: nice
    reason: "Simple module but IAgentCallbacks is key interface"

  - path: src/dashboard/
    suggested_sections:
      - overview
      - usage
    priority: nice
    reason: "Appears to be optional dashboard feature"

# ============================================================================
# UNDOCUMENTED PUBLIC APIs
# Exported functions/types without JSDoc
# ============================================================================

undocumented_apis:
  # Core tokens - critical for DI
  - name: "IAgentRunnerToken"
    location: "src/core/tokens.ts"
    complexity: low
    priority: must
    reason: "DI token - users need to know when/how to use"

  - name: "IAnthropicRunnerToken"
    location: "src/core/tokens.ts"
    complexity: low
    priority: must
    reason: "Provider-specific token vs generic IAgentRunnerToken unclear"

  - name: "IUnifiedEventBusToken"
    location: "src/core/tokens.ts"
    complexity: low
    priority: must
    reason: "New event system - token usage not documented"

  # Event type exports - many types lack explanation
  - name: "FluentHarnessEvent"
    location: "src/harness/event-types.ts:267"
    complexity: medium
    priority: should
    reason: "Union type - no doc explaining when each event fires"

  - name: "HarnessEventType"
    location: "src/harness/event-types.ts:18"
    complexity: low
    priority: should
    reason: "String literal union - no doc on subscription patterns"

  # Factory functions with sparse docs
  - name: "createAgent"
    location: "src/factory/agent-factory.ts"
    complexity: medium
    priority: must
    reason: "Key factory - need examples for common use cases"

  - name: "createTaskHarness"
    location: "src/factory/harness-factory.ts"
    complexity: medium
    priority: must
    reason: "Main harness creation - config options underdocumented"

  - name: "createTestTaskHarness"
    location: "src/factory/harness-factory.ts"
    complexity: low
    priority: should
    reason: "Test helper - what makes it different from createTaskHarness"

  - name: "createWorkflow"
    location: "src/factory/workflow-builder.ts"
    complexity: high
    priority: should
    reason: "Workflow builder pattern - no examples in exports"

  # State management functions
  - name: "completeTask"
    location: "src/harness/task-state.ts"
    complexity: low
    priority: nice
    reason: "Internal state function - exported but usage unclear"

  - name: "createInitialState"
    location: "src/harness/task-state.ts"
    complexity: low
    priority: nice
    reason: "State factory - internal usage pattern"

  # Control flow helpers
  - name: "createParallelHelper"
    location: "src/harness/control-flow.ts:323"
    complexity: medium
    priority: should
    reason: "Factory for parallel - when to use vs direct parallel()"

  - name: "createRetryHelper"
    location: "src/harness/control-flow.ts:308"
    complexity: medium
    priority: should
    reason: "Factory for retry - when to use vs direct retry()"

  # Transport architecture (new)
  - name: "Transport"
    location: "src/core/unified-events/types.ts:200"
    complexity: high
    priority: must
    reason: "New bidirectional interface - extensive but no overview JSDoc"

  - name: "Attachment"
    location: "src/core/unified-events/types.ts:334"
    complexity: medium
    priority: must
    reason: "Core attachment pattern - good inline doc but needs examples"

  - name: "ISessionContext"
    location: "src/core/unified-events/types.ts:393"
    complexity: high
    priority: must
    reason: "Interactive session API - needs comprehensive usage guide"

# ============================================================================
# COMPLEX CODE WITHOUT COMMENTS
# Functions over 30 lines with insufficient explanation
# ============================================================================

complex_code_without_comments:
  - name: "HarnessInstance.run()"
    location: "src/harness/harness-instance.ts:543-598"
    lines: 55
    priority: should
    reason: "Main execution loop - complex state transitions, cleanup order"
    suggested_comment: "Document status transitions, cleanup sequence, error handling"

  - name: "HarnessInstance._createExecuteContext()"
    location: "src/harness/harness-instance.ts:669-824"
    lines: 155
    priority: must
    reason: "Creates phase/task/emit helpers - complex closure patterns"
    suggested_comment: "Document helper creation, unified bus integration, session property"

  - name: "HarnessInstance[Symbol.asyncIterator]()"
    location: "src/harness/harness-instance.ts:470-514"
    lines: 44
    priority: should
    reason: "Async iterator implementation - complex queue/subscription interaction"
    suggested_comment: "Document lifecycle, completion detection, cleanup"

  - name: "TaskHarness.validateTaskResult()"
    location: "src/harness/task-harness.ts:612-729"
    lines: 117
    priority: must
    reason: "Validation loop with retries - complex state machine"
    suggested_comment: "Document retry logic, abort conditions, event emission"

  - name: "TaskHarness.executeTaskLoop()"
    location: "src/harness/task-harness.ts:453-478"
    lines: 25
    priority: should
    reason: "Main task loop - phase events, abort handling"
    suggested_comment: "Document phase boundary detection, fail-fast logic"

  - name: "UnifiedEventBus.emit()"
    location: "src/core/unified-event-bus.ts:159-192"
    lines: 33
    priority: should
    reason: "Core event emission - context merging, error handling"
    suggested_comment: "Document context override behavior, fire-and-forget semantics"

  - name: "BaseAnthropicAgent.run()"
    location: "src/providers/anthropic/agents/base-anthropic-agent.ts:94-122"
    lines: 28
    priority: should
    reason: "Protected run method - timeout racing, callback firing"
    suggested_comment: "Document timeout behavior, callback sequence"

  - name: "toAttachment()"
    location: "src/harness/define-renderer.ts:318-399"
    lines: 81
    priority: must
    reason: "Complex adapter pattern - proxy bus creation"
    suggested_comment: "Document proxy pattern, subscription forwarding"

# ============================================================================
# OUTDATED COMMENTS
# Comments that may not match current implementation
# ============================================================================

outdated_comments:
  - location: "src/harness/task-harness.ts:64-70"
    comment: "@todo Use for rate limit handling in executeWithRetry"
    issue: "_DEFAULT_BACKOFF defined but not used - todo may be stale"
    priority: nice

  - location: "src/harness/task-harness.ts:567"
    comment: "@todo Implement actual timeout using _timeoutMs once CodingAgent is integrated"
    issue: "Mock execution still in place - clarify integration status"
    priority: should

# ============================================================================
# MISSING EXAMPLES
# APIs that would benefit from usage examples
# ============================================================================

missing_examples:
  - name: "defineHarness"
    location: "src/factory/define-harness.ts:216"
    has_example: true
    needs_more: true
    priority: must
    suggested_examples:
      - "Session mode with waitForUser"
      - "Attaching custom renderers"
      - "Error handling patterns"

  - name: "wrapAgent"
    location: "src/factory/wrap-agent.ts:207"
    has_example: true
    needs_more: true
    priority: should
    suggested_examples:
      - "Custom agent with dependencies"
      - "Chaining multiple event handlers"

  - name: "defineRenderer"
    location: "src/harness/define-renderer.ts:287"
    has_example: true
    needs_more: true
    priority: should
    suggested_examples:
      - "State-dependent rendering"
      - "Terminal progress bars"
      - "Streaming output"

  - name: "UnifiedEventBus.scoped()"
    location: "src/core/unified-event-bus.ts:116"
    has_example: true
    needs_more: true
    priority: should
    suggested_examples:
      - "Nested phase/task/agent scopes"
      - "Error propagation in scopes"

  - name: "Transport.attach()"
    location: "src/harness/harness-instance.ts:216"
    has_example: false
    needs_more: true
    priority: must
    suggested_examples:
      - "Metrics collector attachment"
      - "Interactive prompt handler"
      - "Cleanup function usage"

  - name: "SessionContext.waitForUser()"
    location: "src/harness/session-context.ts:86"
    has_example: false
    needs_more: true
    priority: must
    suggested_examples:
      - "Basic prompt with choices"
      - "Timeout handling"
      - "Custom validation"

  - name: "@Monologue decorator"
    location: "src/monologue/monologue-decorator.ts:87"
    has_example: true
    needs_more: true
    priority: should
    suggested_examples:
      - "Custom session ID provider"
      - "Task ID from context"
      - "Custom callback handling"

# ============================================================================
# CONCEPTS NEEDING DOCUMENTATION
# High-level concepts that need dedicated documentation
# ============================================================================

concepts_needing_docs:
  - concept: "Event Systems (3 different systems)"
    current_state: "EventBus (legacy), UnifiedEventBus (new), FluentHarnessEvent (fluent API)"
    doc_needed: "Migration guide, when to use which, event mapping"
    priority: must

  - concept: "API Levels (Level 1, 2, 3)"
    current_state: "wrapAgent (L1), defineHarness no-state (L2), defineHarness with-state (L3)"
    doc_needed: "Decision tree for choosing API level, feature comparison"
    priority: must

  - concept: "Transport Architecture"
    current_state: "New bidirectional communication - HarnessInstance IS Transport"
    doc_needed: "Architecture overview, Attachment pattern, session mode"
    priority: must

  - concept: "Session Mode (Interactive Workflows)"
    current_state: "startSession(), waitForUser(), send(), reply(), abort()"
    doc_needed: "Complete HITL workflow guide, error handling, timeouts"
    priority: must

  - concept: "DI Container Pattern"
    current_state: "needle-di used throughout, tokens in tokens.ts"
    doc_needed: "Container setup, custom bindings, test containers"
    priority: should

  - concept: "Contextual Event Wrapper Pattern"
    current_state: "Used by phase(), task(), retry(), parallel() helpers"
    doc_needed: "Pattern explanation, when events fire, error handling"
    priority: should

  - concept: "Renderer System"
    current_state: "defineRenderer(), IUnifiedRenderer, toAttachment()"
    doc_needed: "Creating renderers, event patterns, terminal output"
    priority: should

  - concept: "Recording and Replay"
    current_state: "ReplayRunner, HarnessRecorder, golden recordings"
    doc_needed: "Recording format, replay testing, scenario management"
    priority: should

  - concept: "Agent Architecture"
    current_state: "BaseAnthropicAgent, IAgent interface, concrete agents"
    doc_needed: "Creating custom agents, callback integration, structured output"
    priority: should

  - concept: "Task Dependency Resolution"
    current_state: "Kahn's algorithm in dependency-resolver.ts"
    doc_needed: "Task format, dependency syntax, cycle handling"
    priority: nice

# ============================================================================
# LIVING DOCS RECOMMENDATIONS
# README per folder with maintained patterns
# ============================================================================

living_docs_recommendations:
  - folder: "src/"
    priority: must
    template_sections:
      - "## Architecture Overview"
      - "## Directory Structure"
      - "## Quick Start by Use Case"
      - "## API Levels Guide"

  - folder: "src/harness/"
    priority: must
    template_sections:
      - "## Module Purpose"
      - "## Event Systems Guide"
      - "## Key Files"
      - "## Patterns Used"

  - folder: "src/core/"
    priority: must
    template_sections:
      - "## Module Purpose"
      - "## DI Container"
      - "## Event Buses"
      - "## Token Reference"

  - folder: "src/factory/"
    priority: should
    template_sections:
      - "## API Levels"
      - "## Factory Functions"
      - "## Examples by Level"
