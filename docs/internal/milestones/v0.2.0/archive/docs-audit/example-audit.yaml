# Open Harness Documentation Example Audit
# Generated: 2026-01-08
# Auditor: Claude (automated)

summary:
  total_examples: 87
  broken_examples: 22
  toy_examples: 31
  threaded_examples: 0  # No threading between examples

  key_issues:
    - "@open-harness/sdk does not exist - actual packages are @open-harness/core, @open-harness/server, etc."
    - "createHub, WebSocketChannel, registerChannel are not exported from any package"
    - "runFlow is in @open-harness/server, not @open-harness/sdk"
    - "parseFlowYaml is in @internal/core, not directly exported from SDK"
    - "defineAgent function does not exist - docs show fabricated API"
    - "Hub.subscribe pattern does not exist in runtime API"
    - "Many YAML examples use incorrect binding syntax (nodes.X.output vs X)"
    - "SqliteRunStore constructor signature is { filename } object, not string"
    - "MemoryRunStore is named InMemoryRunStore in actual code"
    - "recordRun, replayRun functions do not exist"
    - "http.get, http.post, delay, map node types are not registered by default"

examples:
  # ===============================
  # LEARN SECTION
  # ===============================

  - location: "learn/quickstart.mdx:28-33"
    purpose: "Install @open-harness/sdk"
    code_snippet: |
      bun add @open-harness/sdk
    scores:
      realistic: 2
      minimal: 5
      runnable: 1  # Package doesn't exist
      explained: 3
      connected: 2
      average: 2.6
    issues:
      - type: broken
        detail: "@open-harness/sdk package does not exist. Should use @open-harness/core and @open-harness/server"
    connects_to: null
    referenced_by: null

  - location: "learn/quickstart.mdx:39-47"
    purpose: "Define a YAML flow"
    code_snippet: |
      name: hello-world
      nodes:
        - id: hello
          type: hello.agent
          input:
            name: "{{ flow.input.name }}"
      edges: []
    scores:
      realistic: 3
      minimal: 5
      runnable: 4  # Works with custom node
      explained: 3
      connected: 2
      average: 3.4
    issues:
      - type: missing_context
        detail: "No edges array is not idiomatic - should be omitted or show with actual edges"
    connects_to: null
    referenced_by: "learn/quickstart.mdx:54-70"

  - location: "learn/quickstart.mdx:54-70"
    purpose: "Run the flow with TypeScript"
    code_snippet: |
      import { runFlow, parseFlowYaml } from "@open-harness/sdk";
      import { readFileSync } from "node:fs";
      // ...
    scores:
      realistic: 3
      minimal: 4
      runnable: 1
      explained: 3
      connected: 4
      average: 3.0
    issues:
      - type: broken
        detail: "runFlow and parseFlowYaml are not exported from @open-harness/sdk. runFlow is in @open-harness/server, parseFlowYaml is in @internal/core"
    connects_to: "learn/quickstart.mdx:39-47"
    referenced_by: null

  - location: "learn/your-first-agent.mdx:69-120"
    purpose: "Create and run a triage agent flow"
    code_snippet: |
      import {
        createHarness,
        DefaultNodeRegistry,
        parseFlowYaml,
        type NodeTypeDefinition,
        echoNode,
      } from "@open-harness/sdk";
    scores:
      realistic: 4
      minimal: 3
      runnable: 1
      explained: 4
      connected: 3
      average: 3.0
    issues:
      - type: broken
        detail: "Import path @open-harness/sdk doesn't exist. createHarness is in @open-harness/server, parseFlowYaml in @internal/core"
      - type: signature_mismatch
        detail: "ctx.state.get/set signature shown doesn't match StateStore interface (uses path strings, not key-value)"
    connects_to: "learn/quickstart.mdx"
    referenced_by: "learn/multi-agent-flow.mdx"

  - location: "learn/multi-agent-flow.mdx:22-62"
    purpose: "Multi-agent flow YAML with loops"
    code_snippet: |
      flow:
        name: code-with-review
      nodes:
        - id: planner
          type: claude.agent
    scores:
      realistic: 4
      minimal: 3
      runnable: 2
      explained: 4
      connected: 3
      average: 3.2
    issues:
      - type: schema_mismatch
        detail: "YAML shows 'flow:' wrapper which is not valid - FlowDefinition expects 'name' at root"
      - type: bloated
        detail: "type: loop on edge doesn't exist in EdgeDefinition schema"
    connects_to: "learn/your-first-agent.mdx"
    referenced_by: null

  - location: "learn/multi-agent-flow.mdx:88-96"
    purpose: "Run multi-agent flow TypeScript"
    code_snippet: |
      const runtime = createRuntime({ flow, registry });
      const snapshot = await runtime.run({
        task: "Create a function to validate email addresses"
      });
    scores:
      realistic: 4
      minimal: 5
      runnable: 3
      explained: 2
      connected: 3
      average: 3.4
    issues:
      - type: incomplete
        detail: "Missing import statements and registry setup"
    connects_to: "learn/multi-agent-flow.mdx:22-62"
    referenced_by: null

  - location: "learn/persistence.mdx:18-40"
    purpose: "Configure SQLite store"
    code_snippet: |
      import {
        createRuntime,
        SqliteRunStore,
        parseFlowYaml
      } from "@open-harness/sdk";
      const store = new SqliteRunStore("./runs.db");
    scores:
      realistic: 4
      minimal: 4
      runnable: 1
      explained: 3
      connected: 3
      average: 3.0
    issues:
      - type: broken
        detail: "SqliteRunStore constructor takes { filename: string }, not a string directly"
      - type: broken
        detail: "SqliteRunStore is in @open-harness/run-store-sqlite, not @open-harness/sdk"
    connects_to: "learn/multi-agent-flow.mdx"
    referenced_by: null

  - location: "learn/persistence.mdx:45-55"
    purpose: "RunStore interface"
    code_snippet: |
      interface RunStore {
        saveEvent(runId: string, event: RuntimeEvent): Promise<void>;
        getEvents(runId: string): Promise<RuntimeEvent[]>;
        getRun(runId: string): Promise<RunMetadata | null>;
      }
    scores:
      realistic: 3
      minimal: 5
      runnable: 2  # Signature mismatch
      explained: 3
      connected: 2
      average: 3.0
    issues:
      - type: signature_mismatch
        detail: "Actual RunStore interface has appendEvent (sync), loadEvents, saveSnapshot, loadSnapshot - not getEvents/getRun/saveEvent"
    connects_to: null
    referenced_by: null

  - location: "learn/persistence.mdx:67-78"
    purpose: "Recording and replay"
    code_snippet: |
      import { replayRun } from "@open-harness/sdk";
      const recording = await recordRun(flow, registry, input);
    scores:
      realistic: 3
      minimal: 4
      runnable: 1
      explained: 2
      connected: 2
      average: 2.4
    issues:
      - type: broken
        detail: "recordRun and replayRun functions do not exist in codebase"
    connects_to: null
    referenced_by: null

  # ===============================
  # GUIDES - AGENTS
  # ===============================

  - location: "guides/agents/claude-agent.mdx:10-18"
    purpose: "Basic claude.agent usage"
    code_snippet: |
      nodes:
        - id: assistant
          type: claude.agent
          input:
            prompt: "{{ flow.input.question }}"
    scores:
      realistic: 4
      minimal: 5
      runnable: 4
      explained: 3
      connected: 2
      average: 3.6
    issues: []
    connects_to: null
    referenced_by: "guides/agents/claude-agent.mdx:22-32"

  - location: "guides/agents/claude-agent.mdx:59-63"
    purpose: "Subscribe to events"
    code_snippet: |
      hub.subscribe("agent:text", (event) => {
        process.stdout.write(event.event.content);
      });
    scores:
      realistic: 3
      minimal: 5
      runnable: 1
      explained: 2
      connected: 2
      average: 2.6
    issues:
      - type: broken
        detail: "hub.subscribe pattern does not exist. Use runtime.onEvent() instead"
      - type: signature_mismatch
        detail: "Event structure is event.content directly, not event.event.content"
    connects_to: null
    referenced_by: null

  - location: "guides/agents/custom-agents.mdx:12-23"
    purpose: "Agent interface definition"
    code_snippet: |
      interface AgentDefinition<TIn = unknown, TOut = unknown> {
        name: string;
        execute(input: TIn, ctx: AgentContext): Promise<TOut>;
      }
    scores:
      realistic: 2
      minimal: 5
      runnable: 1
      explained: 3
      connected: 2
      average: 2.6
    issues:
      - type: broken
        detail: "AgentDefinition interface does not exist. Should be NodeTypeDefinition with run() method, not execute()"
      - type: broken
        detail: "AgentContext interface doesn't exist. Should be NodeRunContext"
    connects_to: null
    referenced_by: null

  - location: "guides/agents/custom-agents.mdx:27-44"
    purpose: "Define custom agent with defineAgent"
    code_snippet: |
      import { defineAgent } from "@open-harness/sdk";
      export const echoAgent = defineAgent({
        name: "echo",
        inputSchema: z.object({ message: z.string() }),
        async execute(input, ctx) {
          ctx.hub.emit({ type: "agent:start", agentName: "echo" });
    scores:
      realistic: 3
      minimal: 3
      runnable: 1
      explained: 4
      connected: 2
      average: 2.6
    issues:
      - type: broken
        detail: "defineAgent function does not exist. Should use NodeTypeDefinition directly"
      - type: broken
        detail: "ctx.hub does not exist. Use ctx.emit() directly on NodeRunContext"
    connects_to: null
    referenced_by: "guides/agents/custom-agents.mdx:79-92"

  # ===============================
  # GUIDES - EXPRESSIONS
  # ===============================

  - location: "guides/expressions/bindings.mdx:14-17"
    purpose: "Basic binding syntax"
    code_snippet: |
      input:
        prompt: "Hello, {{ flow.input.name }}!"
    scores:
      realistic: 5
      minimal: 5
      runnable: 5
      explained: 4
      connected: 3
      average: 4.4
    issues: []
    connects_to: null
    referenced_by: "guides/expressions/bindings.mdx:32-37"

  - location: "guides/expressions/bindings.mdx:49-58"
    purpose: "Reference previous node output"
    code_snippet: |
      nodes:
        - id: source
          type: constant
          input:
            value: "Welcome"
        - id: greet
          type: echo
          input:
            text: "{{ source.value }} to Open Harness"
    scores:
      realistic: 4
      minimal: 5
      runnable: 4
      explained: 4
      connected: 4
      average: 4.2
    issues: []
    connects_to: "guides/expressions/bindings.mdx:14-17"
    referenced_by: null

  - location: "guides/expressions/conditionals.mdx:14-39"
    purpose: "Conditional edge branching"
    code_snippet: |
      edges:
        - from: classify
          to: handle-urgent
          when: "classify.priority = 'urgent'"
    scores:
      realistic: 4
      minimal: 4
      runnable: 4
      explained: 4
      connected: 3
      average: 3.8
    issues: []
    connects_to: "guides/expressions/bindings.mdx"
    referenced_by: null

  - location: "guides/expressions/iteration.mdx:14-28"
    purpose: "Array mapping with map node"
    code_snippet: |
      nodes:
        - id: process
          type: map
          input:
            items: "{{ flow.input.users }}"
            transform: |
              {{
                {
                  "id": $.id,
                  "displayName": $.firstName & ' ' & $.lastName
                }
              }}
    scores:
      realistic: 3
      minimal: 4
      runnable: 2
      explained: 3
      connected: 2
      average: 2.8
    issues:
      - type: broken
        detail: "map node type is not registered by default - needs custom registration"
      - type: unclear
        detail: "transform property syntax unclear - is this valid map node input?"
    connects_to: null
    referenced_by: null

  # ===============================
  # GUIDES - FLOWS
  # ===============================

  - location: "guides/flows/control-flow.mdx:14-25"
    purpose: "Sequential execution"
    code_snippet: |
      nodes:
        - id: step1
          type: claude.agent
          input:
            prompt: "First step"
        - id: step2
          type: claude.agent
          input:
            prompt: "Uses {{ nodes.step1.output.text }}"
    scores:
      realistic: 3
      minimal: 4
      runnable: 2
      explained: 3
      connected: 2
      average: 2.8
    issues:
      - type: wrong_syntax
        detail: "{{ nodes.step1.output.text }} is wrong. Should be {{ step1.text }}"
    connects_to: null
    referenced_by: null

  - location: "guides/flows/control-flow.mdx:49-56"
    purpose: "Branching with conditions"
    code_snippet: |
      edges:
        - from: router
          to: path-a
          condition: "{{ nodes.router.output.type = 'A' }}"
    scores:
      realistic: 3
      minimal: 5
      runnable: 2
      explained: 3
      connected: 2
      average: 3.0
    issues:
      - type: wrong_syntax
        detail: "condition should be 'when', not 'condition'. Also {{ nodes.X.output.Y }} should be {{ X.Y }}"
    connects_to: null
    referenced_by: null

  - location: "guides/flows/control-flow.mdx:62-79"
    purpose: "Parallel execution"
    code_snippet: |
      nodes:
        - id: fetch-users
          type: http.get
          input:
            url: "/api/users"
    scores:
      realistic: 3
      minimal: 4
      runnable: 1
      explained: 3
      connected: 2
      average: 2.6
    issues:
      - type: broken
        detail: "http.get node type does not exist in codebase"
    connects_to: null
    referenced_by: null

  # ===============================
  # GUIDES - CHANNELS
  # ===============================

  - location: "guides/channels/websocket.mdx:12-24"
    purpose: "WebSocket server setup"
    code_snippet: |
      import { createHub, WebSocketChannel } from "@open-harness/sdk";
      const hub = createHub("session-1");
      const wss = new WebSocketServer({ port: 8080 });
      const wsChannel = new WebSocketChannel(wss);
      hub.registerChannel(wsChannel);
    scores:
      realistic: 3
      minimal: 4
      runnable: 1
      explained: 3
      connected: 2
      average: 2.6
    issues:
      - type: broken
        detail: "createHub, WebSocketChannel, registerChannel do not exist. Actual API uses createHarness with transport.websocket option"
    connects_to: null
    referenced_by: null

  # ===============================
  # GUIDES - DEPLOYMENT
  # ===============================

  - location: "guides/deployment/persistence.mdx:12-17"
    purpose: "InMemoryRunStore usage"
    code_snippet: |
      import { InMemoryRunStore } from "@open-harness/sdk";
      const store = new InMemoryRunStore();
    scores:
      realistic: 4
      minimal: 5
      runnable: 2
      explained: 3
      connected: 2
      average: 3.2
    issues:
      - type: wrong_name
        detail: "Class is named InMemoryRunStore in code but docs show it correctly. However import path is wrong."
    connects_to: null
    referenced_by: null

  - location: "guides/deployment/persistence.mdx:22-28"
    purpose: "SqliteRunStore usage"
    code_snippet: |
      import { SqliteRunStore } from "@open-harness/sdk";
      const store = new SqliteRunStore({ filename: "./data/runs.db" });
    scores:
      realistic: 4
      minimal: 5
      runnable: 2
      explained: 3
      connected: 2
      average: 3.2
    issues:
      - type: broken
        detail: "SqliteRunStore is in @open-harness/run-store-sqlite or re-exported from @open-harness/server, not @open-harness/sdk"
    connects_to: null
    referenced_by: null

  - location: "guides/deployment/production.mdx:18-43"
    purpose: "Express production server"
    code_snippet: |
      import express from "express";
      import {
        createRuntime,
        DefaultNodeRegistry,
        parseFlowYaml,
        SqliteRunStore,
      } from "@open-harness/sdk";
    scores:
      realistic: 4
      minimal: 3
      runnable: 1
      explained: 4
      connected: 3
      average: 3.0
    issues:
      - type: broken
        detail: "Import path wrong. Also SqliteRunStore constructor shown as { filename: '...' } which is correct, but earlier docs show string"
    connects_to: null
    referenced_by: null

  # ===============================
  # CONCEPTS SECTION
  # ===============================

  - location: "concepts/event-system.mdx:69-85"
    purpose: "Subscribing to events"
    code_snippet: |
      hub.subscribe("agent:text", (event) => {
        process.stdout.write(event.event.content);
      });
      hub.subscribe("agent:*", (event) => {
        console.log(event.type, event.event);
      });
    scores:
      realistic: 3
      minimal: 4
      runnable: 1
      explained: 4
      connected: 2
      average: 2.8
    issues:
      - type: broken
        detail: "hub.subscribe does not exist. Use runtime.onEvent() which takes a single listener"
      - type: wrong_signature
        detail: "Wildcard patterns (agent:*) not supported in onEvent"
    connects_to: null
    referenced_by: null

  - location: "concepts/persistence.mdx:42-46"
    purpose: "MemoryRunStore usage"
    code_snippet: |
      import { MemoryRunStore } from "@open-harness/sdk";
      const store = new MemoryRunStore();
    scores:
      realistic: 4
      minimal: 5
      runnable: 1
      explained: 2
      connected: 2
      average: 2.8
    issues:
      - type: wrong_name
        detail: "Class is named InMemoryRunStore, not MemoryRunStore"
    connects_to: null
    referenced_by: null

  # ===============================
  # REFERENCE - API
  # ===============================

  - location: "reference/api/hub.mdx:14-22"
    purpose: "runFlow quick start"
    code_snippet: |
      import { runFlow, parseFlowYaml } from "@open-harness/sdk";
      const snapshot = await runFlow({
        flow: parseFlowYaml(yamlString),
        input: { name: "World" },
      });
    scores:
      realistic: 4
      minimal: 5
      runnable: 2
      explained: 3
      connected: 3
      average: 3.4
    issues:
      - type: broken
        detail: "runFlow is in @open-harness/server, parseFlowYaml is in @internal/core (not directly importable)"
    connects_to: null
    referenced_by: null

  - location: "reference/api/run-store.mdx:12-21"
    purpose: "RunStore interface definition"
    code_snippet: |
      interface RunStore {
        appendEvent(runId: string, event: RuntimeEvent): void;
        saveSnapshot(runId: string, snapshot: RunSnapshot): void;
        loadSnapshot(runId: string): RunSnapshot | null;
        loadEvents(runId: string, afterSeq?: number): RuntimeEvent[];
      }
    scores:
      realistic: 5
      minimal: 5
      runnable: 5
      explained: 4
      connected: 3
      average: 4.4
    issues: []
    connects_to: null
    referenced_by: null

  # ===============================
  # REFERENCE - SCHEMAS
  # ===============================

  - location: "reference/schemas/flow-yaml.mdx:52-85"
    purpose: "Complete flow YAML example"
    code_snippet: |
      id: code-review
      name: Code Review Pipeline
      nodes:
        - id: summarize
          type: claude.agent
          input:
            analysis: "{{ nodes.analyze.output.text }}"
    scores:
      realistic: 4
      minimal: 3
      runnable: 2
      explained: 4
      connected: 3
      average: 3.2
    issues:
      - type: wrong_syntax
        detail: "{{ nodes.analyze.output.text }} should be {{ analyze.text }}"
      - type: schema_mismatch
        detail: "FlowDefinition requires 'name' at root, not 'id' - id doesn't exist in schema"
    connects_to: null
    referenced_by: null

  # ===============================
  # REFERENCE - TYPES
  # ===============================

  - location: "reference/types/flow-definition.mdx:12-21"
    purpose: "FlowDefinition type"
    code_snippet: |
      interface FlowDefinition {
        id: string;
        name?: string;
        description?: string;
        nodes: NodeDefinition[];
        edges?: EdgeDefinition[];
        input?: ZodSchema;
        output?: ZodSchema;
      }
    scores:
      realistic: 3
      minimal: 5
      runnable: 2
      explained: 3
      connected: 2
      average: 3.0
    issues:
      - type: schema_mismatch
        detail: "Actual FlowDefinition has: name (required), version?, state?, nodes, edges (required array). No id, description, input, output fields"
    connects_to: null
    referenced_by: null

  - location: "reference/types/node-definition.mdx:35-36"
    purpose: "Node output reference syntax"
    code_snippet: |
      {{ nodes.greet.output.text }}
    scores:
      realistic: 2
      minimal: 5
      runnable: 1
      explained: 2
      connected: 2
      average: 2.4
    issues:
      - type: wrong_syntax
        detail: "Correct syntax is {{ greet.text }} - node outputs are at root level by id, not nested under nodes.X.output"
    connects_to: null
    referenced_by: null

  - location: "reference/types/node-definition.mdx:47-52"
    purpose: "Built-in node types list"
    code_snippet: |
      Built-in types:
      - claude.agent
      - http.get
      - http.post
      - map
      - delay
    scores:
      realistic: 2
      minimal: 4
      runnable: 1
      explained: 3
      connected: 2
      average: 2.4
    issues:
      - type: broken
        detail: "Only claude.agent, echo, and constant are actually built-in. http.get/post, map, delay do not exist"
    connects_to: null
    referenced_by: null

broken_examples:
  - location: "All files with @open-harness/sdk import"
    issue: "Package @open-harness/sdk does not exist"
    actual_signature: "@open-harness/core, @open-harness/server, @open-harness/stores"
    doc_signature: "@open-harness/sdk"

  - location: "guides/agents/custom-agents.mdx:28"
    issue: "defineAgent function does not exist"
    actual_signature: "Use NodeTypeDefinition<TIn, TOut> directly with type, run() method"
    doc_signature: "defineAgent({ name, inputSchema, execute })"

  - location: "Multiple files (hub.subscribe)"
    issue: "hub.subscribe API does not exist"
    actual_signature: "runtime.onEvent(listener: (event: RuntimeEvent) => void)"
    doc_signature: "hub.subscribe(pattern, callback)"

  - location: "guides/channels/websocket.mdx"
    issue: "createHub, WebSocketChannel, registerChannel do not exist"
    actual_signature: "createHarness({ transport: { websocket: { port } } })"
    doc_signature: "createHub(), new WebSocketChannel(), hub.registerChannel()"

  - location: "Multiple files (binding syntax)"
    issue: "{{ nodes.X.output.Y }} syntax is wrong throughout"
    actual_signature: "{{ X.Y }} - node outputs are bound directly by node id"
    doc_signature: "{{ nodes.X.output.Y }}"

  - location: "learn/persistence.mdx:26"
    issue: "SqliteRunStore constructor signature"
    actual_signature: "new SqliteRunStore({ filename: string })"
    doc_signature: 'new SqliteRunStore("./runs.db")'

  - location: "Multiple files"
    issue: "http.get, http.post, map, delay node types do not exist"
    actual_signature: "Only claude.agent, echo, constant are registered by default"
    doc_signature: "http.get, http.post, map, delay as built-in"

  - location: "learn/persistence.mdx:67-78"
    issue: "recordRun and replayRun functions do not exist"
    actual_signature: "No recording/replay convenience functions exist"
    doc_signature: "await recordRun(flow, registry, input), await replayRun(recording)"

  - location: "reference/types/flow-definition.mdx:12-21"
    issue: "FlowDefinition schema is wrong"
    actual_signature: "{ name: string, version?: number, state?: StateSchemaDefinition, nodes: NodeDefinition[], edges: EdgeDefinition[] }"
    doc_signature: "{ id: string, name?: string, description?: string, nodes, edges?, input?, output? }"

  - location: "reference/schemas/flow-yaml.mdx:12-37"
    issue: "Flow YAML schema shows 'id' as required field"
    actual_signature: "'name' is required, 'id' does not exist in FlowDefinition"
    doc_signature: "id: my-flow (required)"

threading_assessment:
  current_state: "Examples are completely isolated. No example builds on a previous one. Each page starts fresh."

  issues:
    - "quickstart.mdx introduces hello.agent but your-first-agent.mdx starts completely fresh with task.triage"
    - "multi-agent-flow.mdx doesn't build on your-first-agent - introduces code-with-review flow from scratch"
    - "persistence.mdx doesn't continue any previous flow - shows generic store.getRun pattern"
    - "No example carries state, domain, or context from previous examples"
    - "Bindings guide doesn't reference any flow from learn section"
    - "No single domain (e.g., 'coding assistant') threads through all docs"

proposed_thread:
  name: "The Code Review Assistant"
  domain_rationale: |
    Developers building with Open Harness are familiar with code review workflows.
    This domain naturally supports all concepts: state (review history), branching
    (pass/fail), loops (revision cycles), persistence (save reviews), and testing
    (replay review sessions).

  levels:
    - level: 1
      name: "Hello World"
      concept: "Flows execute nodes"
      code: |
        # flow.yaml
        name: hello-reviewer
        nodes:
          - id: greet
            type: echo
            input:
              text: "Code Review Assistant ready!"
        edges: []

        # run.ts
        import { runFlow, parseFlowYaml } from "@open-harness/server";
        const snapshot = await runFlow({
          flow: parseFlowYaml(fs.readFileSync("flow.yaml", "utf-8")),
        });
        console.log(snapshot.outputs.greet.text);
      builds_on: null
      teaches: "Single node flow - input goes in, output comes out"

    - level: 2
      name: "Stateful Reviewer"
      concept: "Workflows have memory"
      code: |
        name: review-counter
        state:
          initial:
            reviewCount: 0
        nodes:
          - id: review
            type: claude.agent
            input:
              prompt: "Review this code: {{ flow.input.code }}"
        # In node: ctx.state.set("reviewCount", count + 1)
      builds_on: "level_1"
      teaches: "State persists across nodes and can be mutated"

    - level: 3
      name: "Data Flow Between Nodes"
      concept: "Nodes communicate through bindings"
      code: |
        nodes:
          - id: analyze
            type: claude.agent
            input:
              prompt: "Analyze: {{ flow.input.code }}"
          - id: suggest
            type: claude.agent
            input:
              prompt: "Based on: {{ analyze.text }}, suggest improvements"
        edges:
          - from: analyze
            to: suggest
      builds_on: "level_2"
      teaches: "{{ nodeId.field }} passes data forward"

    - level: 4
      name: "Branching Reviews"
      concept: "Flows can branch based on data"
      code: |
        nodes:
          - id: classify
            type: claude.agent
            input:
              prompt: "Classify severity: {{ flow.input.code }}"
          - id: critical-handler
            type: claude.agent
            input:
              prompt: "Critical issue found..."
          - id: minor-handler
            type: echo
            input:
              text: "Minor suggestions..."
        edges:
          - from: classify
            to: critical-handler
            when: "classify.severity = 'critical'"
          - from: classify
            to: minor-handler
            when: "classify.severity = 'minor'"
      builds_on: "level_3"
      teaches: "'when' clauses on edges enable conditional branching"

    - level: 5
      name: "Persistent Reviews"
      concept: "Workflows survive restarts"
      code: |
        import { createRuntime } from "@open-harness/server";
        import { SqliteRunStore } from "@open-harness/run-store-sqlite";

        const store = new SqliteRunStore({ filename: "./reviews.db" });
        const runtime = createRuntime({ flow, registry, store });

        // Later: resume from where we left off
        const events = store.loadEvents(runId);
      builds_on: "level_4"
      teaches: "RunStore persists events and snapshots for recovery"

    - level: 6
      name: "Recording Reviews"
      concept: "Test without hitting APIs"
      code: |
        import { withRecording, createMemoryRecordingStore } from "@open-harness/core";

        // Record a real review session
        const store = createMemoryRecordingStore();
        const recordedRuntime = withRecording(runtime, store);
        await recordedRuntime.run(input);

        // Replay in tests - no API calls
        const fixture = store.getRecording();
        // Use fixture in tests
      builds_on: "level_5"
      teaches: "Recording captures real interactions for deterministic replay"

    - level: 7
      name: "Evaluating Review Quality"
      concept: "Data proves what's better"
      code: |
        import { defineSuite, variant, gate } from "@open-harness/core";

        const suite = defineSuite({
          name: "review-quality",
          cases: [
            { input: { code: "function foo() {}" }, expected: { hasSuggestions: true } },
          ],
          variants: [
            variant("sonnet", { model: "claude-sonnet-4-20250514" }),
            variant("haiku", { model: "claude-haiku-3-20250307" }),
          ],
          gates: [
            gate("cost", { maxTokens: 10000 }),
            gate("quality", { minScore: 0.8 }),
          ],
        });
      builds_on: "level_6"
      teaches: "Evals define cases, variants, and gates to systematically compare approaches"

additional_recommendations:
  - "Create a single @open-harness/sdk facade package that re-exports everything for simpler imports"
  - "Add 'import from' comments at top of each code example showing actual package"
  - "Fix all {{ nodes.X.output.Y }} to {{ X.Y }} throughout docs"
  - "Remove references to http.get/post, map, delay until those node types exist"
  - "Add actual recordRun/replayRun convenience functions to match docs"
  - "Consider adding defineAgent helper that wraps NodeTypeDefinition for DX"
  - "Update FlowDefinition docs to match actual Zod schema (name required, no id)"
