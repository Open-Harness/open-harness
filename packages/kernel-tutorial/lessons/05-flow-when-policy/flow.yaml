flow:
  name: flow-when-policy
  nodePacks: [core, tutorial]

nodes:
  - id: facts
    type: constant
    input:
      value: "yes"

  - id: isYes
    type: condition.equals
    input:
      left: "{{facts.value}}"
      right: "yes"

  - id: sayYes
    type: echo
    when:
      equals:
        var: "isYes.value"
        value: true
    policy:
      retry:
        maxAttempts: 2
    input:
      text: "Condition matched: yes"

  - id: flaky
    type: tutorial.flaky
    policy:
      retry:
        maxAttempts: 2
    input:
      label: "retry-ok"

  - id: slow
    type: tutorial.delay
    policy:
      timeoutMs: 5
      continueOnError: true
    input:
      ms: 30

  - id: report
    type: echo
    input:
      text: "timeout failed={{slow.failed}}"

edges:
  - from: facts
    to: isYes
  - from: isYes
    to: sayYes
  - from: sayYes
    to: flaky
  - from: flaky
    to: slow
  - from: slow
    to: report
